{"version":3,"sources":["webpack://watchRTC/webpack/universalModuleDefinition","webpack://watchRTC/./src/index.ts","webpack://watchRTC/./src/sdk.ts","webpack://watchRTC/./src/stats.ts","webpack://watchRTC/./src/types.ts","webpack://watchRTC/./src/utils.ts","webpack://watchRTC/./src/version.ts","webpack://watchRTC/./src/watchrtchttp.ts","webpack://watchRTC/./src/watchrtcsocket.ts","webpack://watchRTC/./src/detect-gpu.js","webpack://watchRTC//Users/yurapostevka/Documents/apps/testrtc/watchrtc-sdk/src/gpu-benchmarks|sync|/^\\.\\/.*$/","webpack://watchRTC/./src/lz-string.js","webpack://watchRTC/webpack/bootstrap","webpack://watchRTC/webpack/startup","webpack://watchRTC/webpack/runtime/global","webpack://watchRTC/webpack/runtime/hasOwnProperty shorthand"],"names":["root","factory","exports","module","define","amd","this","sdk_1","watchrtcConfig","services","initSDK","setConfig","_rtcTags","rating","comment","setUserRating","keys","addKeys","disableDataCollection","enableDataCollection","event","addEvent","id","name","mapStream","mapTrack","connect","disconnect","listener","registerOnStatsListener","nailUpCallEnd","persistentEnd","roomId","peerId","persistentStart","registerStateListener","default","init","addTags","addStatsListener","addStateListener","qualityrtc","run","qrtcRun","stop","qrtcStop","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArray","to","from","pack","ar","l","Array","slice","concat","defineProperty","sdkLogWithoutTrace","sdkLog","trace","getStatsInterval","hardwareInfo","currentAudioOutputId","reconnectTimerId","watchrtcsocket_1","watchrtchttp_1","utils_1","version_1","isBrowser","window","globalContext","isFirefox","mozRTCPeerConnection","openChannels","RTCPeerConnection","navigator","webkitGetUserMedia","peerconnectioncounter","connectionData","watchrtcIdentifiers","rtcRoomId","undefined","rtcPeerId","projectId","http","socket","lastConnectionOpen","tryingToConnectSocket","authFailed","lostConnectionTs","isManualConnect","isManualDisconnect","getStatsCallback","stateListener","freshConnection","getSdkLogger","logLevel","getSdkLogWithoutTrace","debugTrack","track","kind","readyState","muted","mappedTrack","maybeOpenWebsocketConnection","_a","_b","_c","forceRecreate","_d","reconnecting","_e","pcId","_f","nailUp","isDisabledDataCollection","JSON","stringify","disabled","connection","WebSocket","OPEN","isRoomIdOrPeerIdChanged","close","connectionCount","countOfValidConnections","canConnect","validateConfig","forEach","k","useToken","rtcToken","wsConnectionData","getConnectionData","rtcApiKey","proxyUrl","Date","now","startStatsCollection","wsOpeningTimestamp","url","key","options","cleanOldTraces","onData","data","_i","entries","allowBrowserLogCollection","Boolean","collectConsoleLogEnabled","console","override","collectConsoleLogLevel","setConsoleLevel","restoreOriginalConsoleMethods","buffer","filter","connectionId","interval","collectionInterval","oldInterval","resetConnectionState","sdkVersion","watchRTCSessionId","onError","type","onOpen","connectionStatus","reconnectDuration","clearInterval","delta","onClose","closeEvent","code","reason","wasClean","setInterval","_loop_1","pcInfo","pc","signalingState","getStats","res","report","map2obj","nailUpRef","parse","values","stats","peer","streams","logGetStats","connections","__reject","id_1","pc_1","prev_1","prev","nailUpRef_1","base","applyPatchForRTT","subtractNailUpReferenceStats","deltaCompression","timestamp","exposeApplicationStatsForPC","watchrtc","prefixesToWrap","watchRTCInitialized","toString","indexOf","generateID","setTimeout","getHardwareStartTime","getHardwareInfo","hwInfo","getHardwareTime","catch","err","message","urlParams","URLSearchParams","location","search","has","get","socketService","httpService","wsUrl","debug","prefix","origPeerConnection","peerconnection","config","constraints","__rtcStatsId","validConnection","nullConfig","iceServers","server","credential","browserType","addEventListener","candidate","errorCode","errorText","stream","getTracks","map","iceConnectionState","iceGatheringState","connectionState","channel","HTMLMediaElement","nativeMethod_1","setSinkId","selectedDeviceId","mediaDevices","enumerateDevices","devices","currentDevice","find","deviceId","error","RTCRtpTransceiver","origRTCRtpTransceiver","nativeMethod_2","setCodecPreferences","__pcId","RTCRtpSender","nativeMethod_3","origRTCRtpSender","setParameters","nativeMethod_4","replaceTrack","originalTrack","method","nativeMethod","_this_1","join","trackOrKind","transceiver","sender","streamInfo","transceivers","getTransceivers","opts","rtcStatsId","args","description","_this","needToHandleSDPInSuccessCallback","sdp","parameterless","localDescription","generateCertificate","origGetUserMedia","bind","cb","eb","dumpStream","errorData","httpReportError","getUserMedia","origGetUserMedia_1","getDisplayMedia","origGetDisplayMedia_1","level","newWatchrtcConfig","ratingComment","validateRating","opened","promiseFuncs","httpTrace","wasConnected","validateEvent","validatedEvent","source","httpConnectionData","apiKey","loadJS","script","document","createElement","src","onload","onerror","head","appendChild","qrtcStopRequest","progressCallback","answer","codeUrl","queryParams_1","isNetlifyRequest","configUrl","configAnswer","codeLoad","qualityRTC","progressCallbackWrapper","configData","netlifyBaseUrl","log","all","fetch","json","__qualityRTC","Error","progress","jsonConfig","URL","origin","isProbe","wakeLock","getStreamsFromStats","getTransportFromStats","reports","reportKeys","keyPairs","reportKey","nominated","localCandidateId_1","localCandidateId","remoteCandidateId_1","remoteCandidateId","localCandidateKey","remoteCandidateKey","localCandidate","remoteCandidate","candidateType","transport","relayProtocol","address","port","previous","current","currentReportsKeys","streamKey","currentReport","previousReport","direction","currentRemoteReport","remoteId","previousRemoteReport","deltaSeconds","frameWidth","frameHeight","framerate","framesPerSecond","jitter","mappedName","trackIdentifier","bytesReceived","packetsReceived","packetsLost","packetsLoss","bitrate","roundTripTime","bytesSent","packetsSent","fractionLost","mediaSourceKey","mediaSourceId","outboundTrackIdentifier","codecKey","codecId","mimeType","codec","includes","split","mangleChromeStats","logPrefix","GPU","stats_1","getCurrTimeStamp","date","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","logLevels","sdkLogger","getLogLevel","object","allowed","allowedValue","currentValue","_original_log","oldStats","newStats","getTime","isArray","response","standardReport","standardStats","names","stat","m","o","tracks","enabled","proxyURL","localUrl","staging1Url","staging2Url","productionUrl","production1Url","replace","splitted","changed","old","new","channels","parameters","number_format","num","Math","round","toFixed","loadBenchmarks","gpuInfo","memory","fileName","shift","stack","getGPUTier","cores_count","hardwareConcurrency","performance","jsHeapSizeLimit","totalJSHeapSize","usedJSHeapSize","patchConsoleConfig","originalMethodPrefix","methodsToPatch","patchConsoleMethod","methodName","originalMethod","currentMethodIndex","configMethodIndex","text","stringifyArgs","currentIndex","previousIndex","mappedTradk","item","replacerFunc","visited","WeakSet","_key","add","hasOldStats","statsHaveRTTMeasurements","roundTripTimeMeasurements","NaN","referenceStats","referenceReport_1","max","bandwidth","cpu","other","none","random","substring","WatchRTCHttp","_instance","mode","cache","credentials","headers","LZString","WatchRTCSocket","sendInterval","dataCollection","sendPromises","prevMessageTs","timeSinceLastMessage","abs","lines","compressedMessage","compressToEncodedURIComponent","send","timeThreshold_1","relevantTraces","filteredCount","onopen","onclose","onmessage","r","setPrototypeOf","__proto__","a","u","c","throw","return","toLowerCase","userAgent","platform","maxTouchPoints","test","MSStream","isIpad","isMobile","isSafari12","createShader","createProgram","shaderSource","compileShader","attachShader","linkProgram","detachShader","deleteShader","useProgram","createBuffer","bindBuffer","bufferData","Float32Array","getAttribLocation","vertexAttribPointer","enableVertexAttribArray","clearColor","clear","viewport","drawArrays","Uint8Array","readPixels","deleteProgram","deleteBuffer","d","charCodeAt","h","constructor","String","create","mobileTiers","desktopTiers","b","glContext","w","failIfMajorPerformanceCaveat","x","benchmarksURL","A","S","C","E","L","M","j","B","O","T","U","I","D","R","G","N","K","W","tier","screenSize","screen","parseInt","renderer","match","sort","Number","MAX_VALUE","devicePixelRatio","width","height","device","fps","gpu","alpha","antialias","depth","powerPreference","stencil","getContext","getExtension","getParameter","UNMASKED_RENDERER_WEBGL","webpackContext","req","webpackContextResolve","__webpack_require__","charAt","fromCharCode","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressToUint8Array","compress","decompressFromUint8Array","decompress","decompressFromEncodedURIComponent","pow","val","position","index","__webpack_module_cache__","moduleId","__webpack_modules__","globalThis","Function","obj","prop"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"watchRTC\"] = factory();\n\telse\n\t\troot[\"watchRTC\"] = factory();\n})(this, function() {\nreturn ","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.addStateListener = exports.persistentStart = exports.persistentEnd = exports.addStatsListener = exports.disconnect = exports.connect = exports.mapTrack = exports.mapStream = exports.addEvent = exports.enableDataCollection = exports.disableDataCollection = exports.addKeys = exports.setUserRating = exports.addTags = exports.setConfig = exports.init = void 0;\nrequire(\"./types\");\nvar sdk_1 = require(\"./sdk\");\n/**\n * Initialize SDK. Can be called multiple times but it will be initialized only at the first time.\n * Use 'setConfig' function after if you don't have rtcRoomId and rtcPeerId yet.\n * @param watchrtc\n * @param prefixesToWrap\n * @param services\n */\nvar init = function (watchrtcConfig, services) {\n    (0, sdk_1.initSDK)((watchrtcConfig || {}), [\"\"], services);\n};\nexports.init = init;\n/**\n * You also can use watchRTC.setConfig function to set watchRTC configuration after calling init()\n * and before the creation of RTCPeerConnection objects\n */\nvar setConfig = function (watchrtcConfig) {\n    (0, sdk_1.setConfig)(watchrtcConfig);\n};\nexports.setConfig = setConfig;\n/**\n * @deprecated Tags no longer supported. Use addKeys instead\n * Add tags for peer session\n * @param rtcTags[]\n */\nvar addTags = function (\n/** [\"tag1\", \"tag2\", \"tag3\"] */\n_rtcTags) { };\nexports.addTags = addTags;\n/**\n * Set user rating and/or comment for peer session\n * @param rating number from 1 to 5\n * @param comment string\n */\nvar setUserRating = function (\n/** 1 | 2 | 3 | 4 | 5 */\nrating, comment) {\n    (0, sdk_1.setUserRating)(rating, comment);\n};\nexports.setUserRating = setUserRating;\n/**\n * Add keys for peer session\n * @param keys\n */\nvar addKeys = function (\n/** { \"key1\": \"value1\", \"key2\": [\"value2_1\", \"value2_2\"]} */\nkeys) {\n    (0, sdk_1.addKeys)(keys);\n};\nexports.addKeys = addKeys;\n/**\n * Disables data collection\n */\nvar disableDataCollection = function () {\n    (0, sdk_1.disableDataCollection)();\n};\nexports.disableDataCollection = disableDataCollection;\n/**\n * Enables data collection\n */\nvar enableDataCollection = function () {\n    (0, sdk_1.enableDataCollection)();\n};\nexports.enableDataCollection = enableDataCollection;\nvar addEvent = function (event) {\n    (0, sdk_1.addEvent)(event);\n};\nexports.addEvent = addEvent;\n/**\n * Map an incoming stream with a human-readable name\n * @param id The identifier of the stream (streamIdentifier attribute)\n * @param name The human-readable name\n * @deprecated\n */\nvar mapStream = function (id, name) {\n    (0, sdk_1.mapStream)(id, name);\n};\nexports.mapStream = mapStream;\n/**\n * Map an incoming track with a human-readable name\n * @param id The identifier of the track (trackIdentifier attribute)\n * @param name The human-readable name\n */\nvar mapTrack = function (id, name) {\n    (0, sdk_1.mapTrack)(id, name);\n};\nexports.mapTrack = mapTrack;\nvar connect = function () {\n    (0, sdk_1.connect)();\n};\nexports.connect = connect;\nvar disconnect = function () {\n    (0, sdk_1.disconnect)();\n};\nexports.disconnect = disconnect;\nvar addStatsListener = function (listener) {\n    (0, sdk_1.registerOnStatsListener)(listener);\n};\nexports.addStatsListener = addStatsListener;\nvar persistentEnd = function (nailUpCallEnd) {\n    (0, sdk_1.persistentEnd)(nailUpCallEnd);\n};\nexports.persistentEnd = persistentEnd;\nvar persistentStart = function (roomId, peerId) {\n    (0, sdk_1.persistentStart)(roomId, peerId);\n};\nexports.persistentStart = persistentStart;\nvar addStateListener = function (listener) {\n    (0, sdk_1.registerStateListener)(listener);\n};\nexports.addStateListener = addStateListener;\nexports.default = {\n    /**\n     * Initialize SDK. Can be called multiple times but it will be initialized only at the first time.\n     * Use 'setConfig' function after if you don't have rtcRoomId and rtcPeerId yet.\n     * @param watchrtc\n     * @param prefixesToWrap\n     */\n    init: exports.init,\n    /**\n     * @deprecated Tags no longer supported. Use addKeys instead\n     * Add tags for peer session\n     * @param rtcTags[]\n     */\n    addTags: exports.addTags,\n    /**\n     * Set user rating and/or comment for peer session\n     * @param rating number from 1 to 5\n     * @param comment string\n     */\n    setUserRating: exports.setUserRating,\n    /**\n     * Add keys for peer session\n     * @param keys\n     */\n    addKeys: exports.addKeys,\n    /**\n     * You also can use watchRTC.setConfig function to set watchRTC configuration after calling init()\n     * and before the creation of RTCPeerConnection objects\n     */\n    setConfig: exports.setConfig,\n    /**\n     * Disables data collection\n     */\n    disableDataCollection: exports.disableDataCollection,\n    /**\n     * Enables data collection\n     */\n    enableDataCollection: exports.enableDataCollection,\n    addEvent: exports.addEvent,\n    /**\n     * Map an incoming stream with a human-readable name\n     * @param id The identifier of the stream (streamIdentifier attribute)\n     * @param name The human-readable name\n     * @deprecated\n     */\n    mapStream: exports.mapStream,\n    /**\n     * Map an incoming track with a human-readable name\n     * @param id The identifier of the track (trackIdentifier attribute)\n     * @param name The human-readable name\n     */\n    mapTrack: exports.mapTrack,\n    connect: exports.connect,\n    disconnect: exports.disconnect,\n    addStatsListener: exports.addStatsListener,\n    persistentEnd: exports.persistentEnd,\n    persistentStart: exports.persistentStart,\n    addStateListener: exports.addStateListener,\n    qualityrtc: {\n        run: sdk_1.qrtcRun,\n        stop: sdk_1.qrtcStop,\n    },\n};\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.qrtcStop = exports.qrtcRun = exports.persistentStart = exports.persistentEnd = exports.registerStateListener = exports.registerOnStatsListener = exports.disconnect = exports.connect = exports.mapTrack = exports.mapStream = exports.addEvent = exports.enableDataCollection = exports.disableDataCollection = exports.addKeys = exports.setUserRating = exports.setConfig = exports.initSDK = exports.sdkLogWithoutTrace = exports.sdkLog = void 0;\nvar watchrtcsocket_1 = require(\"./watchrtcsocket\");\nvar watchrtchttp_1 = require(\"./watchrtchttp\");\nvar utils_1 = require(\"./utils\");\nvar version_1 = require(\"./version\");\nvar isBrowser = typeof window !== \"undefined\";\nvar globalContext = isBrowser ? window : global;\nvar standardGetstats = true;\nvar isFirefox = isBrowser ? !!globalContext.mozRTCPeerConnection : false;\nvar isSafari = isBrowser\n    ? !isFirefox && globalContext.RTCPeerConnection && !globalContext.navigator.webkitGetUserMedia\n    : false;\n// Data structure for RTCPeerConnection related stuff we need\nvar openChannels = {};\nvar peerconnectioncounter = 0;\nvar connectionData = {};\nvar watchrtcIdentifiers = {\n    rtcRoomId: undefined,\n    rtcPeerId: undefined,\n    projectId: undefined,\n};\nvar watchrtcConfig = null;\nvar http = null;\nvar socket = null;\nvar trace;\nvar lastConnectionOpen = 0; // so we know when was the last active connection seen\nvar getStatsInterval;\nvar tryingToConnectSocket = false;\nvar hardwareInfo;\nvar currentAudioOutputId;\nvar authFailed = false;\nvar reconnectTimerId;\nvar lostConnectionTs = 0;\nvar isManualConnect = false;\nvar isManualDisconnect = false;\nvar getStatsCallback = null;\nvar stateListener = null;\nvar freshConnection = true;\nexports.sdkLog = (0, utils_1.getSdkLogger)(function () { return watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logLevel; });\nexports.sdkLogWithoutTrace = (0, utils_1.getSdkLogWithoutTrace)(function () { return watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logLevel; });\nvar debugTrack = function (track) {\n    if (track) {\n        return \"\".concat(track.kind, \":\").concat(track.id, \" state:\").concat(track.readyState, \" muted:\").concat(track.muted, \" label:\").concat(track.label);\n    }\n    return \"no track\";\n};\n// Data structure for storing and applying mapTrack\nvar mappedTrack = {};\nvar maybeOpenWebsocketConnection = function (_a) {\n    var _b;\n    var _c = _a.forceRecreate, forceRecreate = _c === void 0 ? false : _c, _d = _a.reconnecting, reconnecting = _d === void 0 ? false : _d, _e = _a.pcId, pcId = _e === void 0 ? \"PC_unknown\" : _e, _f = _a.nailUp, nailUp = _f === void 0 ? false : _f;\n    if (socket === null || socket === void 0 ? void 0 : socket.isDisabledDataCollection()) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. disabledDataCollection, ignore [\".concat(pcId, \"]\"));\n        return;\n    }\n    (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection called: [\".concat(pcId, \"]\"), {\n        forceRecreate: forceRecreate,\n        reconnecting: reconnecting,\n        isManualDisconnect: isManualDisconnect,\n        isManualConnect: isManualConnect,\n        tryingToConnectSocket: tryingToConnectSocket,\n        watchrtcConfig: JSON.stringify(watchrtcConfig),\n        disabled: socket === null || socket === void 0 ? void 0 : socket.isDisabledDataCollection(),\n        openChannels: JSON.stringify(openChannels),\n    });\n    isManualDisconnect = false;\n    var opened = ((_b = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _b === void 0 ? void 0 : _b.readyState) === globalContext.WebSocket.OPEN;\n    if (opened) {\n        var roomIdOrPeerIdChanged = (0, utils_1.isRoomIdOrPeerIdChanged)(watchrtcIdentifiers, watchrtcConfig);\n        if (roomIdOrPeerIdChanged && forceRecreate) {\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Closing WS connection. [\".concat(pcId, \"]\"));\n            socket === null || socket === void 0 ? void 0 : socket.close();\n        }\n        else {\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection already opened [\".concat(pcId, \"]\"));\n            return;\n        }\n    }\n    var connectionCount = (0, utils_1.countOfValidConnections)(openChannels);\n    if (!isManualConnect && connectionCount < 1 && !tryingToConnectSocket) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection not opened - previous connect call not finished or missing peer connection [\".concat(pcId, \"]\"), {\n            openChannels: JSON.stringify(openChannels),\n            connectionCount: connectionCount,\n            tryingToConnectSocket: tryingToConnectSocket,\n            isManualConnect: isManualConnect,\n        });\n        return;\n    }\n    var canConnect = (0, utils_1.validateConfig)(watchrtcConfig);\n    var id = Object.keys(openChannels)[connectionCount - 1]; // not very critical, but for consistency with trace\n    if (!canConnect) {\n        tryingToConnectSocket = false;\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection not opened - invalid config [\".concat(pcId, \"]\"), {\n            watchrtcConfig: watchrtcConfig,\n        });\n        return;\n    }\n    if (watchrtcConfig.keys) {\n        Object.keys(watchrtcConfig.keys || {}).forEach(function (k) {\n            if (typeof watchrtcConfig.keys[k] === \"string\") {\n                watchrtcConfig.keys[k] = [watchrtcConfig.keys[k]];\n            }\n        });\n    }\n    var useToken = !!watchrtcConfig.rtcToken;\n    var wsConnectionData = (0, utils_1.getConnectionData)(\"ws\", useToken ? watchrtcConfig.rtcToken : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    if (!socket) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS socket wasn't initialized [\".concat(pcId, \"]\"));\n    }\n    tryingToConnectSocket = true;\n    lastConnectionOpen = Date.now();\n    (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Opening websocket connection [\".concat(pcId, \"]\"));\n    startStatsCollection(nailUp);\n    var wsOpeningTimestamp = Date.now();\n    socket === null || socket === void 0 ? void 0 : socket.connect({\n        url: \"\".concat(wsConnectionData.url, \"?\").concat(useToken ? \"token\" : \"apiKey\", \"=\").concat(wsConnectionData.key, \"&timestamp=\").concat(Date.now()),\n        options: { cleanOldTraces: freshConnection },\n        onData: function (data) {\n            var _a;\n            for (var _i = 0, _b = Object.entries(data); _i < _b.length; _i++) {\n                var _c = _b[_i], key = _c[0], value = _c[1];\n                connectionData[key] = value;\n            }\n            watchrtcIdentifiers.projectId = data.projectId;\n            tryingToConnectSocket = false;\n            watchrtcConfig.allowBrowserLogCollection = Boolean(data.collectConsoleLogEnabled);\n            if (!watchrtcConfig.allowBrowserLogCollection) {\n                (0, utils_1.restoreOriginalConsoleMethods)();\n                // clean up collected logs from socket buffer\n                if (socket === null || socket === void 0 ? void 0 : socket.buffer) {\n                    socket.buffer = socket.buffer.filter(function (data) { return data[0] !== \"log\"; });\n                }\n            }\n            else {\n                if (!((_a = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.console) === null || _a === void 0 ? void 0 : _a.override) && data.collectConsoleLogLevel) {\n                    (0, utils_1.setConsoleLevel)(data.collectConsoleLogLevel, trace);\n                }\n            }\n            (0, exports.sdkLog)(\"info\", \"Connection established. watchRTCConnectionId: \".concat(data.connectionId, \" sdkVersion:\").concat(version_1.default, \" [\").concat(pcId, \"]\"));\n            if (data.interval !== watchrtcConfig.collectionInterval) {\n                var oldInterval = watchrtcConfig.collectionInterval;\n                watchrtcConfig.collectionInterval = data.interval;\n                resetConnectionState();\n                startStatsCollection();\n                (0, exports.sdkLog)(\"error\", \"Collection interval mismatch - connection state reset\");\n                trace({ data: [\"collectionIntervalChange\", null, { oldInterval: oldInterval }] });\n            }\n            trace({ data: [\"watchrtc\", id, __assign(__assign(__assign({}, watchrtcConfig), data), { sdkVersion: version_1.default })] });\n            if (reconnecting) {\n                (0, exports.sdkLog)(\"debug\", \"websocket onData reconnecting\");\n                trace({ data: [\"reconnect\", null, null] });\n            }\n            if (hardwareInfo) {\n                trace({ data: [\"hardware\", null, hardwareInfo] });\n            }\n            trace({ data: [\"sessionId\", null, globalContext.watchRTCSessionId] });\n        },\n        onError: function (_, type) {\n            (0, exports.sdkLog)(\"debug\", \"websocket onError \".concat(type));\n            if (type === \"auth\") {\n                authFailed = true;\n            }\n            tryingToConnectSocket = false;\n            lastConnectionOpen = 0;\n        },\n        onOpen: function () {\n            freshConnection = false;\n            if (stateListener) {\n                stateListener({ connectionStatus: \"connected\" });\n            }\n            if (reconnecting) {\n                var reconnectDuration = Date.now() - lostConnectionTs;\n                trace({ data: [\"reconnectDuration\", null, reconnectDuration] });\n            }\n            authFailed = false;\n            if (reconnectTimerId) {\n                clearInterval(reconnectTimerId);\n                reconnectTimerId = undefined;\n            }\n            var delta = Date.now() - wsOpeningTimestamp;\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Connection opened. Opening time - \".concat(delta, \" ms [\").concat(pcId, \"]\"));\n        },\n        onClose: function (closeEvent) {\n            if (stateListener) {\n                stateListener({ connectionStatus: \"disconnected\" });\n            }\n            var code = closeEvent.code, reason = closeEvent.reason, wasClean = closeEvent.wasClean;\n            (0, exports.sdkLog)(\"debug\", \"close event. authFailed: \".concat(authFailed, \" code: \").concat(code, \" reason: \").concat(reason, \" wasClean: \").concat(wasClean, \" reconnectTimerId: \").concat(reconnectTimerId), { authFailed: authFailed, code: code, reason: reason, wasClean: wasClean, reconnectTimerId: reconnectTimerId });\n            if (authFailed) {\n                (0, exports.sdkLog)(\"debug\", \"websocket authFailed\");\n                if (reconnectTimerId) {\n                    clearInterval(reconnectTimerId);\n                }\n            }\n            else if (!reconnectTimerId && !isManualDisconnect) {\n                (0, exports.sdkLog)(\"debug\", \"websocket onClose reconnecting\");\n                lostConnectionTs = Date.now();\n                maybeOpenWebsocketConnection({ reconnecting: true, pcId: pcId });\n                reconnectTimerId = setInterval(function () {\n                    maybeOpenWebsocketConnection({ reconnecting: true, pcId: pcId });\n                }, 30 * 1000);\n            }\n        },\n    });\n};\nvar startStatsCollection = function (nailUp) {\n    if (nailUp === void 0) { nailUp = false; }\n    globalContext.clearInterval(getStatsInterval);\n    if (nailUp) {\n        (0, exports.sdkLog)(\"debug\", \"startStatsCollection - nail up\");\n        var _loop_1 = function (pcInfo) {\n            if (pcInfo.pc.signalingState !== \"closed\") {\n                pcInfo.pc.getStats(null).then(function (res) {\n                    var now = {};\n                    if (standardGetstats || isFirefox || isSafari) {\n                        if (isFirefox) {\n                            res.forEach(function (report) {\n                                now[\"\".concat(report.type, \"_\").concat(report.id)] = report;\n                            });\n                        }\n                        else {\n                            now = (0, utils_1.map2obj)(res);\n                        }\n                    }\n                    else {\n                        now = (0, utils_1.mangleChromeStats)(pcInfo.pc, res);\n                    }\n                    pcInfo.nailUpRef = JSON.parse(JSON.stringify(now));\n                });\n            }\n        };\n        // collect the new reference reports to use\n        for (var _i = 0, _a = Object.values(openChannels); _i < _a.length; _i++) {\n            var pcInfo = _a[_i];\n            _loop_1(pcInfo);\n        }\n    }\n    getStatsInterval = globalContext.setInterval(function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var stats, _i, _a, pcInfo, _b, peer, streams;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!(!isManualConnect && (0, utils_1.countOfValidConnections)(openChannels) === 0)) return [3 /*break*/, 1];\n                        if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                            (0, exports.sdkLog)(\"debug\", \"getStatsInterval. No valid connections at this time\");\n                        }\n                        // if we don't have any connection for 20 sec we can close the socket\n                        if (lastConnectionOpen && lastConnectionOpen + 20000 < Date.now()) {\n                            freshConnection = true;\n                            globalContext.clearInterval(getStatsInterval);\n                            socket === null || socket === void 0 ? void 0 : socket.close();\n                            (0, exports.sdkLog)(\"info\", \"Last connection closed. watchRTCConnectionId: \".concat(connectionData === null || connectionData === void 0 ? void 0 : connectionData.connectionId, \" sdkVersion: \").concat(version_1.default));\n                        }\n                        return [3 /*break*/, 6];\n                    case 1:\n                        lastConnectionOpen = Date.now();\n                        stats = { connections: {}, streams: {} };\n                        _i = 0, _a = Object.values(openChannels);\n                        _c.label = 2;\n                    case 2:\n                        if (!(_i < _a.length)) return [3 /*break*/, 5];\n                        pcInfo = _a[_i];\n                        if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                            (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStatsInterval. \".concat(pcInfo.id, \" signalingState: \").concat(pcInfo.pc.signalingState));\n                        }\n                        if (!(pcInfo.pc.signalingState !== \"closed\")) return [3 /*break*/, 4];\n                        return [4 /*yield*/, getStats(pcInfo)];\n                    case 3:\n                        _b = _c.sent(), peer = _b.peer, streams = _b.streams;\n                        stats.connections = __assign(__assign({}, stats.connections), peer);\n                        stats.streams = __assign(__assign({}, stats.streams), streams);\n                        _c.label = 4;\n                    case 4:\n                        _i++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        if (getStatsCallback) {\n                            getStatsCallback(stats);\n                        }\n                        _c.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    }, watchrtcConfig.collectionInterval);\n};\nvar getStats = function (pcInfo) {\n    return new Promise(function (resolve, __reject) {\n        if (pcInfo) {\n            var id_1 = pcInfo.id, pc_1 = pcInfo.pc, prev_1 = pcInfo.prev, nailUpRef_1 = pcInfo.nailUpRef;\n            if (standardGetstats || isFirefox || isSafari) {\n                pc_1.getStats(null).then(function (res) {\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats res\", { res: res });\n                    }\n                    var now = {};\n                    if (isFirefox) {\n                        res.forEach(function (report) {\n                            now[\"\".concat(report.type, \"_\").concat(report.id)] = report;\n                        });\n                    }\n                    else {\n                        now = (0, utils_1.map2obj)(res);\n                    }\n                    var base = JSON.parse(JSON.stringify(now)); // our new prev\n                    now = (0, utils_1.applyPatchForRTT)(prev_1, now);\n                    if (nailUpRef_1) {\n                        now = (0, utils_1.subtractNailUpReferenceStats)(nailUpRef_1, now);\n                    }\n                    var data = (0, utils_1.deltaCompression)(prev_1, now);\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats(null) [\".concat(id_1, \"]\"), { data: data });\n                    }\n                    if ((data === null || data === void 0 ? void 0 : data.timestamp) !== null && (data === null || data === void 0 ? void 0 : data.timestamp) !== -Infinity) {\n                        trace({ data: [\"getstats\", id_1, data] });\n                    }\n                    pcInfo.prev = base;\n                    resolve((0, utils_1.exposeApplicationStatsForPC)(id_1, prev_1, now, mappedTrack));\n                });\n            }\n            else {\n                pc_1.getStats(function (res) {\n                    var now = (0, utils_1.mangleChromeStats)(pc_1, res);\n                    var base = JSON.parse(JSON.stringify(now)); // our new prev\n                    if (nailUpRef_1) {\n                        now = (0, utils_1.subtractNailUpReferenceStats)(nailUpRef_1, now);\n                    }\n                    var data = (0, utils_1.deltaCompression)(prev_1, now);\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats() [\".concat(id_1, \"]\"), { data: data });\n                    }\n                    if ((data === null || data === void 0 ? void 0 : data.timestamp) !== null && (data === null || data === void 0 ? void 0 : data.timestamp) !== -Infinity) {\n                        trace({ data: [\"getstats\", id_1, data] });\n                    }\n                    pcInfo.prev = base;\n                    resolve((0, utils_1.exposeApplicationStatsForPC)(id_1, prev_1, now, mappedTrack));\n                });\n            }\n        }\n    });\n};\nvar getHardware = function () {\n    setTimeout(function () {\n        // if get hardware take more than 50 ms then do not save it\n        var getHardwareStartTime = Date.now();\n        (0, utils_1.getHardwareInfo)()\n            .then(function (hwInfo) {\n            var getHardwareTime = Date.now() - getHardwareStartTime;\n            if (getHardwareTime <= 50000) {\n                hardwareInfo = hwInfo;\n                (0, exports.sdkLog)(\"debug\", \"getHardware\", { hardwareInfo: hardwareInfo });\n            }\n            else {\n                (0, exports.sdkLog)(\"debug\", \"getHardware failure: getHardwareTime: \".concat(getHardwareTime), { hardwareInfo: hardwareInfo });\n            }\n        })\n            .catch(function (err) {\n            (0, exports.sdkLog)(\"error\", \"Error. Get hardware info: \".concat(err.message));\n        });\n    }, 0);\n};\n/**\n * Initialize SDK.\n * @param watchrtc\n * @param prefixesToWrap\n * @param services\n */\nvar initSDK = function (watchrtc, prefixesToWrap, services) {\n    var _a, _b;\n    var initialized = globalContext.watchRTCInitialized;\n    if (initialized) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"init. watchRTC SDK already has been initialized\");\n        return;\n    }\n    if (!globalContext.RTCPeerConnection) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"init. RTCPeerConnection does not exist in global globalContext\");\n        return;\n    }\n    var isRTCPeerConnectionNative = globalContext.RTCPeerConnection.toString().indexOf(\"[native code]\") !== -1;\n    if (!isRTCPeerConnectionNative && isBrowser) {\n        (0, exports.sdkLog)(\"info\", \"init. RTCPeerConnection object has been already overridden\");\n    }\n    globalContext.watchRTCInitialized = true;\n    globalContext.watchRTCSessionId = (0, utils_1.generateID)();\n    getHardware();\n    if (isBrowser) {\n        var urlParams = new URLSearchParams(location.search);\n        if (urlParams.has(\"watchrtc\") && urlParams.get(\"watchrtc\") === \"debug\") {\n            watchrtc.logLevel = \"debug\";\n        }\n    }\n    socket = (services === null || services === void 0 ? void 0 : services.socketService) || new watchrtcsocket_1.default();\n    http = (services === null || services === void 0 ? void 0 : services.httpService) || new watchrtchttp_1.default();\n    watchrtc.collectionInterval = (_a = watchrtc.collectionInterval) !== null && _a !== void 0 ? _a : 8000;\n    watchrtc.logLevel = watchrtc.logLevel || \"debug\";\n    watchrtcConfig = watchrtc;\n    watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n    watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n    trace = socket.trace;\n    if (watchrtcConfig.wsUrl) {\n        (0, exports.sdkLog)(\"info\", \"\\\"wsUrl\\\" config property is deprecated. Use \\\"proxyUrl\\\" instead of it\");\n    }\n    if (watchrtcConfig.proxyUrl) {\n        (0, exports.sdkLog)(\"info\", \"\\\"proxyUrl\\\" is used\");\n    }\n    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.debug) {\n        (0, exports.sdkLog)(\"info\", \"\\\"debug\\\" config property is deprecated. Use \\\"logLevel\\\" instead of it\");\n    }\n    prefixesToWrap.forEach(function (prefix) {\n        if (!globalContext[prefix + \"RTCPeerConnection\"]) {\n            (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection prefixes override failed\");\n            return;\n        }\n        var origPeerConnection = globalContext[prefix + \"RTCPeerConnection\"];\n        var peerconnection = function (config, constraints) {\n            if (config === null || config === void 0 ? void 0 : config.watchrtc) {\n                watchrtcConfig = __assign(__assign({}, watchrtcConfig), config.watchrtc);\n                watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n                watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n            }\n            var pc = new origPeerConnection(config, constraints);\n            var id = \"PC_\" + peerconnectioncounter++;\n            pc.__rtcStatsId = id;\n            openChannels[id] = {\n                id: id,\n                pc: pc,\n                validConnection: false,\n            };\n            if (!config) {\n                config = { nullConfig: true };\n            }\n            config = JSON.parse(JSON.stringify(config)); // deepcopy\n            // don't log credentials\n            ((config && config.iceServers) || []).forEach(function (server) {\n                delete server.credential;\n            });\n            if (config === null || config === void 0 ? void 0 : config.watchrtc) {\n                delete config.watchrtc;\n            }\n            if (isFirefox) {\n                config.browserType = \"moz\";\n            }\n            else {\n                config.browserType = \"webkit\";\n            }\n            (0, exports.sdkLog)(\"debug\", \"new RTCPeerConnection called.\", {\n                config: JSON.stringify(config),\n                constraints: constraints,\n            });\n            trace({ data: [\"create\", id, config] });\n            // TODO: do we want to log constraints here? They are chrome-proprietary.\n            // http://stackoverflow.com/questions/31003928/what-do-each-of-these-experimental-goog-rtcpeerconnectionconstraints-do\n            if (constraints) {\n                trace({ data: [\"constraints\", id, constraints] });\n            }\n            pc.addEventListener(\"icecandidate\", function (e) {\n                (0, exports.sdkLog)(\"debug\", \"onicecandidate id:[\".concat(id, \"], candidate:[\").concat(e.candidate, \"]\"));\n                trace({ data: [\"onicecandidate\", id, e.candidate] });\n            });\n            pc.addEventListener(\"icecandidateerror\", function (e) {\n                (0, exports.sdkLog)(\"debug\", \"onicecandidateerror id:[\".concat(id, \"], error:[\").concat(e.errorCode, \":\").concat(e.errorText, \"]\"));\n                trace({ data: [\"onicecandidateerror\", id, \"\".concat(e.errorCode, \":\").concat(e.errorText)] });\n            });\n            pc.addEventListener(\"addstream\", function (e) {\n                trace({\n                    data: [\n                        \"onaddstream\",\n                        id,\n                        e.stream.id +\n                            \" \" +\n                            e.stream.getTracks().map(function (t) {\n                                return t.kind + \":\" + t.id;\n                            }),\n                    ],\n                });\n            });\n            pc.addEventListener(\"track\", function (e) {\n                trace({\n                    data: [\n                        \"ontrack\",\n                        id,\n                        debugTrack(e.track) +\n                            \" \" +\n                            e.streams.map(function (stream) {\n                                return \"stream:\" + stream.id;\n                            }),\n                    ],\n                });\n                // https://redmine.testrtc.com/issues/7166\n                e.track.addEventListener(\"ended\", function () {\n                    trace({\n                        data: [\n                            \"ontrack\",\n                            id,\n                            debugTrack(e.track) +\n                                \" \" +\n                                e.streams.map(function (stream) {\n                                    return \"stream:\" + stream.id;\n                                }),\n                        ],\n                    });\n                });\n                // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                // e.track.addEventListener(\"mute\", () => {\n                //   trace({\n                //     data: [\n                //       \"ontrack\",\n                //       id,\n                //       debugTrack(e.track) +\n                //         \" \" +\n                //         e.streams.map((stream: any) => {\n                //           return \"stream:\" + stream.id;\n                //         }),\n                //     ],\n                //   });\n                // });\n                //\n                // e.track.addEventListener(\"unmute\", () => {\n                //   trace({\n                //     data: [\n                //       \"ontrack\",\n                //       id,\n                //       debugTrack(e.track) +\n                //         \" \" +\n                //         e.streams.map((stream: any) => {\n                //           return \"stream:\" + stream.id;\n                //         }),\n                //     ],\n                //   });\n                // });\n            });\n            pc.addEventListener(\"removestream\", function (e) {\n                trace({\n                    data: [\n                        \"onremovestream\",\n                        id,\n                        e.stream.id +\n                            \" \" +\n                            e.stream.getTracks().map(function (t) {\n                                return t.kind + \":\" + t.id;\n                            }),\n                    ],\n                });\n            });\n            pc.addEventListener(\"signalingstatechange\", function () {\n                if (openChannels[id] && !openChannels[id].validConnection) {\n                    openChannels[id].validConnection = true;\n                    setTimeout(function () {\n                        (0, exports.sdkLog)(\"debug\", \"signalingstatechage. forceRecreate websocket connection[\".concat(id, \"]\"), {\n                            openChannels: JSON.stringify(openChannels),\n                        });\n                        maybeOpenWebsocketConnection({ forceRecreate: true, pcId: id });\n                    }, 5000);\n                }\n                else {\n                    (0, exports.sdkLog)(\"debug\", \"signalingstatechage. WS connection opening not triggered - peer connection not in channels or was already opened [\".concat(id, \"]\"), { openChannels: JSON.stringify(openChannels) });\n                }\n                trace({ data: [\"onsignalingstatechange\", id, pc.signalingState] });\n            });\n            pc.addEventListener(\"iceconnectionstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"oniceconnectionstatechange id:[\".concat(id, \"], state:[\").concat(pc.iceConnectionState, \"]\"));\n                trace({ data: [\"oniceconnectionstatechange\", id, pc.iceConnectionState] });\n            });\n            pc.addEventListener(\"icegatheringstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onicegatheringstatechange id:[\".concat(id, \"], state:[\").concat(pc.iceGatheringState, \"]\"));\n                trace({ data: [\"onicegatheringstatechange\", id, pc.iceGatheringState] });\n            });\n            pc.addEventListener(\"connectionstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onconnectionstatechange id:[\".concat(id, \"], state:[\").concat(pc.connectionState, \"]\"));\n                trace({ data: [\"onconnectionstatechange\", id, pc.connectionState] });\n            });\n            pc.addEventListener(\"negotiationneeded\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onnegotiationneeded id:[\".concat(id, \"]\"));\n                trace({ data: [\"onnegotiationneeded\", id, undefined] });\n            });\n            pc.addEventListener(\"datachannel\", function (event) {\n                (0, exports.sdkLog)(\"debug\", \"ondatachannel id:[\".concat(id, \"], data:[\").concat(event.channel.id, \" \").concat(event.channel.label, \"]\"));\n                trace({ data: [\"ondatachannel\", id, [event.channel.id, event.channel.label]] });\n            });\n            // https://redmine.testrtc.com/issues/6529\n            // pc.addEventListener(\"iceconnectionstatechange\", () => {\n            //   if (pc.iceConnectionState === \"connected\") {\n            //     getStats(openChannels[id]);\n            //   }\n            // });\n            (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection override complete [\".concat(id, \"].\"));\n            return pc;\n        };\n        if (\"HTMLMediaElement\" in globalContext && \"setSinkId\" in HTMLMediaElement.prototype) {\n            var nativeMethod_1 = HTMLMediaElement.prototype.setSinkId;\n            HTMLMediaElement.prototype.setSinkId = function () {\n                var selectedDeviceId = arguments[0];\n                navigator.mediaDevices\n                    .enumerateDevices()\n                    .then(function (devices) {\n                    var currentDevice = devices.find(function (_a) {\n                        var deviceId = _a.deviceId;\n                        return deviceId === selectedDeviceId;\n                    });\n                    if (currentDevice && currentDevice.deviceId !== currentAudioOutputId) {\n                        trace({ data: [\"audioOutputChange\", null, currentDevice.label] });\n                    }\n                    currentAudioOutputId = selectedDeviceId;\n                })\n                    .catch(function (error) {\n                    (0, exports.sdkLog)(\"debug\", error.message, { error: error });\n                });\n                return nativeMethod_1.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpTransceiver.setCodecPreferences\n        if (\"RTCRtpTransceiver\" in globalContext && \"setCodecPreferences\" in globalContext.RTCRtpTransceiver.prototype) {\n            var origRTCRtpTransceiver = globalContext.RTCRtpTransceiver;\n            var nativeMethod_2 = origRTCRtpTransceiver.prototype.setCodecPreferences;\n            origRTCRtpTransceiver.prototype.setCodecPreferences = function () {\n                trace({ data: [\"setCodecPreferences\", this.__pcId, arguments] });\n                return nativeMethod_2.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpSender.setParameters\n        if (\"RTCRtpSender\" in globalContext && \"setParameters\" in globalContext.RTCRtpSender.prototype) {\n            var origRTCRtpSender = globalContext.RTCRtpSender;\n            var nativeMethod_3 = origRTCRtpSender.prototype.setParameters;\n            origRTCRtpSender.prototype.setParameters = function () {\n                trace({ data: [\"setParameters\", this.__pcId, arguments] });\n                return nativeMethod_3.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpSender.replaceTrack\n        if (\"RTCRtpSender\" in globalContext && \"replaceTrack\" in globalContext.RTCRtpSender.prototype) {\n            var origRTCRtpSender = globalContext.RTCRtpSender;\n            var nativeMethod_4 = origRTCRtpSender.prototype.replaceTrack;\n            origRTCRtpSender.prototype.replaceTrack = function () {\n                var track = arguments[0];\n                if (track) {\n                    trace({\n                        data: [\"replaceTrack\", this.__pcId, debugTrack(track)],\n                    });\n                    // Check if the label is not the same as previous one - to detect a device change\n                    var originalTrack = this.track;\n                    if (originalTrack && originalTrack.label !== track.label) {\n                        trace({ data: [\"\".concat(track.kind, \"InputChange\"), this.__pcId, track.label] });\n                    }\n                }\n                else {\n                    trace({ data: [\"replaceTrack\", this.__pcId, null] });\n                }\n                return nativeMethod_4.apply(this, arguments);\n            };\n        }\n        // adding pc id to sender for above logic\n        [\"addTransceiver\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var streams = \"\";\n                    if (arguments[1] && arguments[1].streams) {\n                        streams = arguments[1].streams.map(function (s) { return \"stream:\" + s.id; }).join(\";\");\n                    }\n                    var trackOrKind = typeof arguments[0] === \"string\"\n                        ? arguments[0]\n                        : arguments[0].kind + \":\" + arguments[0].id + \" \" + arguments[0].label;\n                    var init = arguments[1] ? __assign(__assign({}, arguments[1]), { streams: streams }) : null;\n                    trace({ data: [method, this.__rtcStatsId, [trackOrKind, init]] });\n                    var transceiver = nativeMethod.apply(this, arguments);\n                    transceiver.sender.__pcId = this.__rtcStatsId;\n                    // https://redmine.testrtc.com/issues/7166\n                    var track = arguments[0];\n                    if (typeof track === \"object\") {\n                        trace({\n                            data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        });\n                        track.addEventListener(\"ended\", function () {\n                            trace({\n                                data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track)],\n                            });\n                        });\n                        // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                        // track.addEventListener(\"mute\", () => {\n                        //   trace({\n                        //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        //   });\n                        // });\n                        //\n                        // track.addEventListener(\"unmute\", () => {\n                        //   trace({\n                        //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        //   });\n                        // });\n                    }\n                    return transceiver;\n                };\n            }\n        });\n        [\"createDataChannel\", \"restartIce\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    trace({ data: [method, this.__rtcStatsId, arguments] });\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"close\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    trace({ data: [method, this.__rtcStatsId, arguments] });\n                    delete openChannels[this.__rtcStatsId];\n                    isManualDisconnect = true;\n                    (0, exports.sdkLog)(\"debug\", \"on RTCPeerConnection(\".concat(this.__rtcStatsId, \") close\"));\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"addStream\", \"removeStream\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var stream = arguments[0];\n                    var streamInfo = stream\n                        .getTracks()\n                        .map(function (t) {\n                        return t.kind + \":\" + t.id;\n                    })\n                        .join(\",\");\n                    trace({ data: [method, this.__rtcStatsId, stream.id + \" \" + streamInfo] });\n                    // https://redmine.testrtc.com/issues/7166\n                    if (method === \"addStream\") {\n                        stream.getTracks().map(function (track) {\n                            trace({\n                                data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            });\n                            track.addEventListener(\"ended\", function () {\n                                trace({\n                                    data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                                });\n                            });\n                            // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                            // track.addEventListener(\"mute\", () => {\n                            //   trace({\n                            //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            //   });\n                            // });\n                            //\n                            // track.addEventListener(\"unmute\", () => {\n                            //   trace({\n                            //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            //   });\n                            // });\n                        });\n                    }\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"addTrack\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var track = arguments[0];\n                    var streams = [].slice.call(arguments, 1);\n                    trace({\n                        data: [\n                            method,\n                            this.__rtcStatsId,\n                            debugTrack(track) +\n                                \" \" +\n                                (streams\n                                    .map(function (s) {\n                                    return \"stream:\" + s.id;\n                                })\n                                    .join(\";\") || \"-\"),\n                        ],\n                    });\n                    // https://redmine.testrtc.com/issues/7166\n                    trace({\n                        data: [\n                            \"onlocaltrack\",\n                            this.__rtcStatsId,\n                            debugTrack(track) +\n                                \" \" +\n                                streams.map(function (stream) {\n                                    return \"stream:\" + stream.id;\n                                }),\n                        ],\n                    });\n                    track.addEventListener(\"ended\", function () {\n                        trace({\n                            data: [\n                                \"onlocaltrack\",\n                                _this_1.__rtcStatsId,\n                                debugTrack(track) +\n                                    \" \" +\n                                    streams.map(function (stream) {\n                                        return \"stream:\" + stream.id;\n                                    }),\n                            ],\n                        });\n                    });\n                    // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                    // track.addEventListener(\"mute\", () => {\n                    //   trace({\n                    //     data: [\n                    //       \"onlocaltrack\",\n                    //       this.__rtcStatsId,\n                    //       debugTrack(track) +\n                    //         \" \" +\n                    //         streams.map((stream: any) => {\n                    //           return \"stream:\" + stream.id;\n                    //         }),\n                    //     ],\n                    //   });\n                    // });\n                    //\n                    // track.addEventListener(\"unmute\", () => {\n                    //   trace({\n                    //     data: [\n                    //       \"onlocaltrack\",\n                    //       this.__rtcStatsId,\n                    //       debugTrack(track) +\n                    //         \" \" +\n                    //         streams.map((stream: any) => {\n                    //           return \"stream:\" + stream.id;\n                    //         }),\n                    //     ],\n                    //   });\n                    // });\n                    var sender = nativeMethod.apply(this, arguments);\n                    sender.__pcId = this.__rtcStatsId;\n                    // Associate the peer id to the existing transceivers\n                    var transceivers = this.getTransceivers();\n                    if (transceivers) {\n                        transceivers.forEach(function (transceiver) {\n                            transceiver.__pcId = _this_1.__rtcStatsId;\n                        });\n                    }\n                    return sender;\n                };\n            }\n        });\n        [\"removeTrack\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var track = arguments[0].track;\n                    trace({\n                        data: [method, this.__rtcStatsId, track ? debugTrack(track) : \"null\"],\n                    });\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"createOffer\", \"createAnswer\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var rtcStatsId = this.__rtcStatsId;\n                    var args = arguments;\n                    var opts;\n                    if (arguments.length === 1 && typeof arguments[0] === \"object\") {\n                        opts = arguments[0];\n                    }\n                    else if (arguments.length === 3 && typeof arguments[2] === \"object\") {\n                        opts = arguments[2];\n                    }\n                    trace({ data: [method, this.__rtcStatsId, opts] });\n                    return nativeMethod.apply(this, opts ? [opts] : undefined).then(function (description) {\n                        trace({ data: [method + \"OnSuccess\", rtcStatsId, description] });\n                        if (args.length > 0 && typeof args[0] === \"function\") {\n                            args[0].apply(null, [description]);\n                            return undefined;\n                        }\n                        return description;\n                    }, function (err) {\n                        trace({ data: [method + \"OnFailure\", rtcStatsId, err.toString()] });\n                        if (args.length > 1 && typeof args[1] === \"function\") {\n                            args[1].apply(null, [err]);\n                            return;\n                        }\n                        throw err;\n                    });\n                };\n            }\n        });\n        [\"setLocalDescription\", \"setRemoteDescription\", \"addIceCandidate\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var rtcStatsId = this.__rtcStatsId;\n                    var args = arguments;\n                    var _this = this;\n                    // because of setLocalDescription(null) sometimes we don't have SDP value\n                    // fippo suggested: Access pc.localDescription.sdp in the successcallback\n                    var needToHandleSDPInSuccessCallback = method === \"setLocalDescription\" && (!args[0] || (args[0] && !args[0].sdp));\n                    trace({\n                        data: [method, this.__rtcStatsId, needToHandleSDPInSuccessCallback ? { parameterless: true } : args[0]],\n                    });\n                    return nativeMethod.apply(this, [args[0]]).then(function () {\n                        trace({\n                            data: [\n                                method + \"OnSuccess\",\n                                rtcStatsId,\n                                needToHandleSDPInSuccessCallback ? _this === null || _this === void 0 ? void 0 : _this.localDescription : undefined,\n                            ],\n                        });\n                        if (args.length >= 2 && typeof args[1] === \"function\") {\n                            args[1].apply(null, []);\n                            return undefined;\n                        }\n                        return undefined;\n                    }, function (err) {\n                        trace({ data: [method + \"OnFailure\", rtcStatsId, err.toString()] });\n                        if (args.length >= 3 && typeof args[2] === \"function\") {\n                            args[2].apply(null, [err]);\n                            return undefined;\n                        }\n                        throw err;\n                    });\n                };\n            }\n        });\n        // wrap static methods. Currently just generateCertificate.\n        if (origPeerConnection.generateCertificate) {\n            Object.defineProperty(peerconnection, \"generateCertificate\", {\n                get: function () {\n                    return arguments.length\n                        ? origPeerConnection.generateCertificate.apply(null, arguments)\n                        : origPeerConnection.generateCertificate;\n                },\n            });\n        }\n        globalContext[prefix + \"RTCPeerConnection\"] = peerconnection;\n        globalContext[prefix + \"RTCPeerConnection\"].prototype = origPeerConnection.prototype;\n        (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection prefixes override complete\");\n    });\n    if (isBrowser) {\n        // getUserMedia wrappers\n        prefixesToWrap.forEach(function (prefix) {\n            var name = prefix + (prefix.length ? \"GetUserMedia\" : \"getUserMedia\");\n            if (!navigator[name]) {\n                return;\n            }\n            var origGetUserMedia = navigator[name].bind(navigator);\n            var gum = function () {\n                trace({ data: [\"getUserMedia\", null, arguments[0]] });\n                var cb = arguments[1];\n                var eb = arguments[2];\n                origGetUserMedia(arguments[0], function (stream) {\n                    // we log the stream id, track ids and tracks readystate since that is ended GUM fails\n                    // to acquire the cam (in chrome)\n                    trace({ data: [\"getUserMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    if (cb) {\n                        cb(stream);\n                    }\n                }, function (err) {\n                    var errorData = [\"getUserMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    if (eb) {\n                        eb(err);\n                    }\n                });\n            };\n            navigator[name] = gum.bind(navigator);\n        });\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n            var origGetUserMedia_1 = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n            var gum = function () {\n                trace({ data: [\"navigator.mediaDevices.getUserMedia\", null, arguments[0]] });\n                return origGetUserMedia_1.apply(navigator.mediaDevices, arguments).then(function (stream) {\n                    trace({ data: [\"navigator.mediaDevices.getUserMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    return stream;\n                }, function (err) {\n                    var errorData = [\"navigator.mediaDevices.getUserMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    return Promise.reject(err);\n                });\n            };\n            navigator.mediaDevices.getUserMedia = gum.bind(navigator.mediaDevices);\n        }\n        // getDisplayMedia\n        if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n            var origGetDisplayMedia_1 = navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);\n            var gdm = function () {\n                trace({ data: [\"navigator.mediaDevices.getDisplayMedia\", null, arguments[0]] });\n                return origGetDisplayMedia_1.apply(navigator.mediaDevices, arguments).then(function (stream) {\n                    trace({ data: [\"navigator.mediaDevices.getDisplayMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    return stream;\n                }, function (err) {\n                    var errorData = [\"navigator.mediaDevices.getDisplayMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    return Promise.reject(err);\n                });\n            };\n            navigator.mediaDevices.getDisplayMedia = gdm.bind(navigator.mediaDevices);\n        }\n    }\n    if ((_b = watchrtc.console) === null || _b === void 0 ? void 0 : _b.level) {\n        (0, utils_1.setConsoleLevel)(watchrtc.console.level, trace);\n    }\n};\nexports.initSDK = initSDK;\nvar setConfig = function (newWatchrtcConfig) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var collectConsoleDisabled = (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.allowBrowserLogCollection) === false;\n    if (!collectConsoleDisabled && ((_a = newWatchrtcConfig === null || newWatchrtcConfig === void 0 ? void 0 : newWatchrtcConfig.console) === null || _a === void 0 ? void 0 : _a.override) === true && newWatchrtcConfig.console.level) {\n        (0, utils_1.setConsoleLevel)(newWatchrtcConfig.console.level, trace);\n    }\n    if (\"collectionInterval\" in newWatchrtcConfig) {\n        delete newWatchrtcConfig.collectionInterval;\n    }\n    watchrtcConfig = __assign(__assign({}, watchrtcConfig), newWatchrtcConfig);\n    watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n    watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n    (0, exports.sdkLog)(\"debug\", \"setConfig\", {\n        newWatchrtcConfig: JSON.stringify(newWatchrtcConfig),\n        watchrtcConfig: JSON.stringify(watchrtcConfig),\n    });\n    maybeOpenWebsocketConnection({});\n};\nexports.setConfig = setConfig;\n/**\n * Set user rating and/or comment for peer session\n * @param rating number from 1 to 5\n * @param comment string\n */\nvar setUserRating = function (\n/** 1 | 2 | 3 | 4 | 5 */\nrating, ratingComment) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return Promise.resolve({ error: \"SDK is not initialized. Use 'init' function first.\" });\n    }\n    var isValidRating = (0, utils_1.validateRating)(rating);\n    if (!isValidRating) {\n        return Promise.resolve({ error: \"Rating is invalid\" });\n    }\n    var opened = ((_a = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _a === void 0 ? void 0 : _a.readyState) === globalContext.WebSocket.OPEN;\n    var data = [\"userRating\", null, { rating: rating, ratingComment: ratingComment }];\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        if (opened) {\n            trace({ data: data, options: options });\n        }\n        else {\n            httpTrace.apply(void 0, data).then(function () { return resolve({}); })\n                .catch(function (error) { return resolve({ error: error }); });\n        }\n    });\n};\nexports.setUserRating = setUserRating;\n/**\n * Add keys for peer session\n * @param keys\n */\nvar addKeys = function (\n/** { \"key1\": \"value1\", \"key2\": [\"value2_1\", \"value2_2\"]} */\nkeys) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    Object.keys(keys || {}).forEach(function (k) {\n        if (typeof keys[k] === \"string\") {\n            keys[k] = [keys[k]];\n        }\n    });\n    var data = [\"keys\", null, keys];\n    var opened = ((_a = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _a === void 0 ? void 0 : _a.readyState) === globalContext.WebSocket.OPEN;\n    var wasConnected = socket === null || socket === void 0 ? void 0 : socket.wasConnected;\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        if (opened) {\n            trace({ data: data, options: options });\n        }\n        else if (!wasConnected) {\n            trace({ data: data, options: options });\n        }\n        else {\n            httpTrace.apply(void 0, data).then(function () { return resolve({}); })\n                .catch(function (error) { return resolve({ error: error }); });\n        }\n    });\n};\nexports.addKeys = addKeys;\nvar disableDataCollection = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    trace({ data: [\"disableDataCollection\", null, null] });\n    socket === null || socket === void 0 ? void 0 : socket.disableDataCollection();\n};\nexports.disableDataCollection = disableDataCollection;\nvar enableDataCollection = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    trace({ data: [\"enableDataCollection\", null, null] });\n    socket === null || socket === void 0 ? void 0 : socket.enableDataCollection();\n};\nexports.enableDataCollection = enableDataCollection;\nvar addEvent = function (event) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"addEvent error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    // const opened = socket?.connection?.readyState === WS.OPEN;\n    // if (!opened && socket?.wasConnected) {\n    //   sdkLog(\"error\", `addEvent error. Connection has been closed.`);\n    //   return;\n    // }\n    var isEventValid = (0, utils_1.validateEvent)(event, openChannels);\n    if (!isEventValid) {\n        return;\n    }\n    // Don't keep `pc` information in event, only extract the id\n    var validatedEvent = __assign({}, event);\n    var source = null;\n    if (validatedEvent.pc) {\n        source = validatedEvent.pc.__rtcStatsId || null;\n        delete validatedEvent.pc;\n    }\n    var data = [\"event\", source, validatedEvent];\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        trace({ data: data, options: options });\n    });\n};\nexports.addEvent = addEvent;\nvar mapStream = function (id, name) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"mapStream error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var isDataValid = !!id && !!name;\n    if (!isDataValid) {\n        return;\n    }\n    var data = [\"mapStream\", null, { id: id, name: name }];\n    (0, exports.sdkLog)(\"info\", \"mapStream method is deprecated. Please use mapTrack instead.\");\n    trace({ data: data });\n};\nexports.mapStream = mapStream;\nvar mapTrack = function (id, name) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"mapTrack error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var isDataValid = !!id && !!name;\n    if (!isDataValid) {\n        return;\n    }\n    mappedTrack[id] = name;\n    var data = [\"mapTrack\", null, { id: id, name: name }];\n    trace({ data: data });\n};\nexports.mapTrack = mapTrack;\nvar connect = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"connect error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    freshConnection = true;\n    isManualConnect = true;\n    (0, exports.sdkLog)(\"debug\", \"manual connect\");\n    maybeOpenWebsocketConnection({});\n};\nexports.connect = connect;\nvar disconnect = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"disconnect error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    isManualConnect = false;\n    isManualDisconnect = true;\n    socket === null || socket === void 0 ? void 0 : socket.close();\n    (0, exports.sdkLog)(\"debug\", \"manual disconnect\");\n};\nexports.disconnect = disconnect;\nvar registerOnStatsListener = function (listener) {\n    getStatsCallback = listener;\n};\nexports.registerOnStatsListener = registerOnStatsListener;\nvar registerStateListener = function (listener) {\n    stateListener = listener;\n};\nexports.registerStateListener = registerStateListener;\nvar httpTrace = function () {\n    var _a;\n    var data = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        data[_i] = arguments[_i];\n    }\n    if (!watchrtcIdentifiers.rtcRoomId || !watchrtcIdentifiers.rtcPeerId) {\n        var message = \"Missing configuration parameters rtcPeerId and rtcRoomId to connect\";\n        if (!watchrtcIdentifiers.rtcRoomId && watchrtcIdentifiers.rtcPeerId) {\n            message = \"Missing configuration parameter rtcRoomId to connect\";\n        }\n        else if (!watchrtcIdentifiers.rtcPeerId && watchrtcIdentifiers.rtcRoomId) {\n            message = \"Missing configuration parameter rtcPeerId to connect\";\n        }\n        (0, exports.sdkLog)(\"error\", message);\n        return Promise.reject(message);\n    }\n    if (!watchrtcIdentifiers.projectId && !watchrtcConfig.rtcApiKey) {\n        var message = \"Missing apiKey to enable trace before connection establishment\";\n        (0, exports.sdkLog)(\"info\", message);\n        return Promise.reject(message);\n    }\n    var httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    return http\n        ? http.trace.apply(http, __spreadArray([\"\".concat(httpConnectionData.url, \"/trace\"), (_a = watchrtcIdentifiers.projectId) !== null && _a !== void 0 ? _a : httpConnectionData.key, watchrtcIdentifiers.rtcRoomId,\n            watchrtcIdentifiers.rtcPeerId], data, false)) : Promise.reject(\"Invalid configuration of http service\");\n};\nvar httpReportError = function (data) {\n    var apiKey = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey;\n    var rtcRoomId = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcRoomId;\n    var rtcPeerId = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcPeerId;\n    if (!apiKey || !rtcRoomId || !rtcPeerId) {\n        (0, exports.sdkLog)(\"error\", \"Cannot report an error. Please provide rtcApiKey, rtcRoomId and rtcPeerId \");\n        return;\n    }\n    var httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    data = data || (socket === null || socket === void 0 ? void 0 : socket.buffer) || [];\n    http === null || http === void 0 ? void 0 : http.trace(\"\".concat(httpConnectionData.url, \"/error\"), httpConnectionData.key, rtcRoomId, rtcPeerId, data);\n};\nvar persistentEnd = function (nailUpCallEnd) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"persistentEnd error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    clearInterval(getStatsInterval);\n    isManualConnect = false;\n    isManualDisconnect = true;\n    socket === null || socket === void 0 ? void 0 : socket.close(nailUpCallEnd);\n    (0, exports.sdkLog)(\"debug\", \"persistentEnd. sessionId: \".concat(globalContext.watchRTCSessionId));\n};\nexports.persistentEnd = persistentEnd;\nvar resetConnectionState = function () {\n    var _a;\n    (0, exports.sdkLog)(\"debug\", \"resetConnectionState sessionId: \".concat(globalContext.watchRTCSessionId));\n    for (var _i = 0, _b = Object.values(openChannels); _i < _b.length; _i++) {\n        var channel = _b[_i];\n        channel.prev = null;\n    }\n    if ((_a = socket === null || socket === void 0 ? void 0 : socket.buffer) === null || _a === void 0 ? void 0 : _a.length) {\n        socket.buffer = socket.buffer.filter(function (_a) {\n            var traceType = _a[0];\n            return traceType !== \"getstats\";\n        });\n    }\n};\nvar persistentStart = function (roomId, peerId) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"persistentStart error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    watchrtcConfig = __assign(__assign({}, watchrtcConfig), { rtcRoomId: roomId, rtcPeerId: peerId });\n    watchrtcIdentifiers.rtcRoomId = roomId;\n    watchrtcIdentifiers.rtcPeerId = peerId;\n    resetConnectionState();\n    maybeOpenWebsocketConnection({ nailUp: true });\n    (0, exports.sdkLog)(\"debug\", \"persistentStart. sessionId: \".concat(globalContext.watchRTCSessionId), { watchrtcConfig: watchrtcConfig });\n};\nexports.persistentStart = persistentStart;\n// (globalContext as any).setUserRating = setUserRating;\n// (globalContext as any).addTags = addTags;\n// (globalContext as any).addKeys = addKeys;\n// (globalContext as any).init = initSDK;\n// (globalContext as any).addEvent = addEvent;\n// (globalContext as any).wrtcConnect = connect;\n// (globalContext as any).wrtcDisconnect = disconnect;\n/* QRTC SDK part */\nvar loadJS = function (url) {\n    return new Promise(function (resolve, reject) {\n        var script = document.createElement(\"script\");\n        script.src = url;\n        script.onload = resolve;\n        script.onerror = reject;\n        document.head.appendChild(script);\n    });\n};\nvar loadConfig = function (url) { return __awaiter(void 0, void 0, void 0, function () {\n    var response;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0: return [4 /*yield*/, fetch(url)];\n            case 1:\n                response = _a.sent();\n                return [4 /*yield*/, response.json()];\n            case 2: return [2 /*return*/, _a.sent()];\n        }\n    });\n}); };\nvar qrtcStopRequest = false;\n/*\n    const answer = await watchRTC.qualityrtc.run({\n      options: {\n        // run: \"Location\",\n\n        // if missing, will use default unpkg.com values\n        codeUrl: `http://localhost:8081/lib/main.bundle.js`,\n\n        // should not be passed, and will read from watchRTC server, passing this for development testing\n        configUrl: `https://niceincontact.testrtc.com/.netlify/functions/get-config`\n      },\n      progressCallback});\n\n */\nvar qrtcRun = function (_a) {\n    var options = _a.options, progressCallback = _a.progressCallback;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var answer, codeUrl, queryParams_1, httpConnectionData, isNetlifyRequest, configUrl, _b, configAnswer, codeLoad, qualityRTC, progressCallbackWrapper, configData, netlifyBaseUrl, config;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (!isBrowser) {\n                        (0, exports.sdkLogWithoutTrace)(\"info\", \"Cannot run qualityRTC test in non-browser environment\");\n                        return [2 /*return*/];\n                    }\n                    qrtcStopRequest = false;\n                    // disable WatchRTC SDK data collection while QRTC SDK working\n                    (0, exports.disableDataCollection)();\n                    _c.label = 1;\n                case 1:\n                    _c.trys.push([1, , 4, 5]);\n                    codeUrl = (options === null || options === void 0 ? void 0 : options.codeUrl) || \"https://qualityrtc-sdk.s3.amazonaws.com/\".concat(version_1.default, \"/main.bundle.js\");\n                    queryParams_1 = {};\n                    if (options) {\n                        Object.keys(options || {}).forEach(function (key) {\n                            if (typeof options[key] === \"string\") {\n                                queryParams_1[key] = options[key];\n                            }\n                        });\n                    }\n                    httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n                    isNetlifyRequest = !!(options === null || options === void 0 ? void 0 : options.configUrl);\n                    configUrl = isNetlifyRequest\n                        ? \"\".concat(options.configUrl, \"/.netlify/functions/get-config\")\n                        : httpConnectionData.url +\n                            \"/get-qualityrtc-config?apiKey=\".concat(httpConnectionData.key, \"&\").concat(new URLSearchParams(queryParams_1));\n                    console.log(\"runNetworkTest: request to run, loading lib and config\", {\n                        codeUrl: codeUrl,\n                        configUrl: configUrl,\n                    });\n                    return [4 /*yield*/, Promise.all([loadConfig(configUrl), loadJS(codeUrl)])];\n                case 2:\n                    _b = _c.sent(), configAnswer = _b[0], codeLoad = _b[1];\n                    console.log(\"runNetworkTest:JS code & config loaded\", {\n                        codeLoad: codeLoad,\n                        configAnswer: configAnswer,\n                    });\n                    qualityRTC = globalContext.__qualityRTC;\n                    if (!qualityRTC) {\n                        throw new Error(\"runNetworkTest:Failed to load qualityRTC, __qualityRTC is undefined\");\n                    }\n                    progressCallbackWrapper = function (progress) {\n                        if (qrtcStopRequest) {\n                            return false;\n                        }\n                        else if (progressCallback) {\n                            progressCallback(progress);\n                        }\n                        return true;\n                    };\n                    configData = isNetlifyRequest ? configAnswer.config : configAnswer.jsonConfig.config;\n                    netlifyBaseUrl = isNetlifyRequest ? options === null || options === void 0 ? void 0 : options.configUrl : new URL(configAnswer.url).origin;\n                    config = __assign(__assign({}, configData), { isProbe: true, options: __assign(__assign(__assign({}, configData.options), options), { wakeLock: true, netlifyBaseUrl: netlifyBaseUrl }) });\n                    console.log(\"runNetworkTest: code & config loaded, running test\", {\n                        config: config,\n                        configData: configData,\n                        qualityRTC: qualityRTC,\n                        netlifyBaseUrl: netlifyBaseUrl,\n                    });\n                    return [4 /*yield*/, qualityRTC.run({\n                            config: config,\n                            progressCallback: progressCallbackWrapper,\n                        })];\n                case 3:\n                    answer = _c.sent();\n                    console.log(\"runNetworkTest:JS Test completed\", { answer: answer });\n                    return [3 /*break*/, 5];\n                case 4:\n                    (0, exports.enableDataCollection)();\n                    return [7 /*endfinally*/];\n                case 5: return [2 /*return*/, answer];\n            }\n        });\n    });\n};\nexports.qrtcRun = qrtcRun;\nvar qrtcStop = function () {\n    if (!isBrowser) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"Cannot run qualityRTC test in non-browser environment\");\n        return;\n    }\n    qrtcStopRequest = true;\n};\nexports.qrtcStop = qrtcStop;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getStreamsFromStats = exports.getTransportFromStats = void 0;\nvar getTransportFromStats = function (id, reports) {\n    if (!reports) {\n        return null;\n    }\n    var reportKeys = Object.keys(reports);\n    var keyPairs = reportKeys.filter(function (reportKey) { return reports[reportKey].type === \"candidate-pair\" && reports[reportKey].nominated; });\n    if (keyPairs.length > 0) {\n        var _a = reports[keyPairs[0]], localCandidateId_1 = _a.localCandidateId, remoteCandidateId_1 = _a.remoteCandidateId;\n        var localCandidateKey = reportKeys.find(function (reportKey) { return reports[reportKey].type === \"local-candidate\" && reports[reportKey].id === localCandidateId_1; });\n        var remoteCandidateKey = reportKeys.find(function (reportKey) { return reports[reportKey].type === \"remote-candidate\" && reports[reportKey].id === remoteCandidateId_1; });\n        if (localCandidateKey && remoteCandidateKey) {\n            var localCandidate = reports[localCandidateKey];\n            var remoteCandidate = reports[remoteCandidateKey];\n            var peer = {};\n            peer[id] = {\n                connection: localCandidate.candidateType === \"relay\" ? \"relay\" : \"direct\",\n                transport: localCandidate.candidateType === \"relay\" ? localCandidate.relayProtocol : \"udp\",\n                address: \"\".concat(remoteCandidate.address, \":\").concat(remoteCandidate.port),\n            };\n            return peer;\n        }\n    }\n    return null;\n};\nexports.getTransportFromStats = getTransportFromStats;\nvar getStreamsFromStats = function (id, previous, current, mappedTrack) {\n    var streams = {};\n    var currentReportsKeys = Object.keys(current);\n    var streamsKeys = currentReportsKeys.filter(function (keys) { return current[keys].type === \"inbound-rtp\" || current[keys].type === \"outbound-rtp\"; });\n    streamsKeys.forEach(function (streamKey) {\n        var currentReport = current[streamKey];\n        var previousReport = previous && streamKey in previous ? previous[streamKey] : null;\n        var direction = currentReport.type === \"inbound-rtp\" ? \"inbound\" : \"outbound\";\n        var kind = currentReport.kind;\n        var currentRemoteReport = currentReport.remoteId in current ? current[currentReport.remoteId] : null;\n        var previousRemoteReport = previousReport && previousReport.remoteId in previous ? previous[previousReport.remoteId] : null;\n        var deltaSeconds = previousReport ? (currentReport.timestamp - previousReport.timestamp) / 1000 : null;\n        var stream = {\n            direction: direction,\n            kind: kind,\n            peerId: id,\n        };\n        // Specific video (in inbound, outbound\n        if (kind === \"video\") {\n            stream.frameWidth = currentReport.frameWidth;\n            stream.frameHeight = currentReport.frameHeight;\n            stream.framerate = currentReport.framesPerSecond;\n        }\n        if (currentReport.type === \"inbound-rtp\") {\n            stream.jitter = currentReport.jitter;\n            // For inbound stream, trackIdentifier is part of the inbound-rtp report\n            stream.mappedName =\n                currentReport.trackIdentifier in mappedTrack ? mappedTrack[currentReport.trackIdentifier] : null;\n            // Compute intermediate values if previous report exists\n            stream.bytesReceived = previousReport ? currentReport.bytesReceived - previousReport.bytesReceived : null;\n            stream.packetsReceived = previousReport ? currentReport.packetsReceived - previousReport.packetsReceived : null;\n            stream.packetsLost = previousReport ? currentReport.packetsLost - previousReport.packetsLost : null;\n            stream.packetsLoss =\n                stream.packetsLost + stream.packetsReceived > 0\n                    ? (stream.packetsLost * 100) / (stream.packetsLost + stream.packetsReceived)\n                    : null;\n            stream.bitrate = deltaSeconds ? (stream.bytesReceived * 8) / deltaSeconds : null;\n            // Compute intermediate stats from remoteId (remoteOutbound);\n            stream.roundTripTime =\n                currentRemoteReport && \"roundTripTime\" in currentRemoteReport ? currentRemoteReport.roundTripTime : null;\n        }\n        else {\n            // Compute intermediate values if previous report exists\n            stream.bytesSent = previousReport ? currentReport.bytesSent - previousReport.bytesSent : null;\n            stream.packetsSent = previousReport ? currentReport.packetsSent - previousReport.packetsSent : null;\n            stream.bitrate = deltaSeconds ? (stream.bytesSent * 8) / deltaSeconds : null;\n            // Compute intermediate stats from remoteId (remoteInbound)\n            stream.roundTripTime =\n                currentRemoteReport && \"roundTripTime\" in currentRemoteReport ? currentRemoteReport.roundTripTime : null;\n            stream.jitter = currentRemoteReport && \"jitter\" in currentRemoteReport ? currentRemoteReport.jitter : null;\n            stream.packetsLost =\n                currentRemoteReport && previousRemoteReport\n                    ? currentRemoteReport.packetsLost - previousRemoteReport.packetsLost\n                    : null;\n            stream.packetsLoss =\n                currentRemoteReport && \"fractionLost\" in currentRemoteReport ? currentRemoteReport.fractionLost : null;\n            // For outbound stream, trackIdentifier is part of the media-source report\n            var mediaSourceKey = currentReportsKeys.find(function (key) { return current[key].id === currentReport.mediaSourceId; });\n            if (mediaSourceKey) {\n                var outboundTrackIdentifier = current[mediaSourceKey].trackIdentifier;\n                stream.mappedName = outboundTrackIdentifier in mappedTrack ? mappedTrack[outboundTrackIdentifier] : null;\n            }\n        }\n        // Compute codec name from codecId (codec)\n        var codecKey = currentReportsKeys.find(function (key) { return current[key].id === currentReport.codecId; });\n        if (codecKey) {\n            var mimeType = current[codecKey].mimeType || \"\";\n            stream.codec = mimeType.includes(\"/\") ? mimeType.split(\"/\")[1] : mimeType;\n        }\n        streams[current[streamKey].id] = stream;\n    });\n    return streams;\n};\nexports.getStreamsFromStats = getStreamsFromStats;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateID = exports.subtractNailUpReferenceStats = exports.applyPatchForRTT = exports.exposeApplicationStatsForPC = exports.restoreOriginalConsoleMethods = exports.setConsoleLevel = exports.getHardwareInfo = exports.validateEvent = exports.validateRating = exports.isRoomIdOrPeerIdChanged = exports.countOfValidConnections = exports.validateConfig = exports.getConnectionData = exports.dumpStream = exports.map2obj = exports.mangleChromeStats = exports.deltaCompression = exports.getSdkLogWithoutTrace = exports.getSdkLogger = exports.logPrefix = void 0;\nvar GPU = require(\"./detect-gpu\");\nvar stats_1 = require(\"./stats\");\nvar sdk_1 = require(\"./sdk\");\nvar getCurrTimeStamp = function () {\n    var date = new Date();\n    var dateStr = (\"00\" + (date.getMonth() + 1)).slice(-2) +\n        \"/\" +\n        (\"00\" + date.getDate()).slice(-2) +\n        \"/\" +\n        date.getFullYear() +\n        \" \" +\n        (\"00\" + date.getHours()).slice(-2) +\n        \":\" +\n        (\"00\" + date.getMinutes()).slice(-2) +\n        \":\" +\n        (\"00\" + date.getSeconds()).slice(-2) +\n        \":\" +\n        (\"000\" + date.getMilliseconds()).slice(-3);\n    return dateStr;\n};\nvar logPrefix = function (level) {\n    if (level === void 0) { level = \"info\"; }\n    return level === \"error\"\n        ? [\n            \"\".concat(getCurrTimeStamp(), \" %cwatchRTC %cERROR\"),\n            \"background: \".concat(\"gold\", \"; color: black; padding: 2px 0.5em; border-radius: 0.5em;\"),\n            \"background: \".concat(\"red\", \"; color: white; padding: 2px 0.5em; border-radius: 0.5em;\"),\n        ]\n        : [\n            \"\".concat(getCurrTimeStamp(), \" %cwatchRTC\"),\n            \"background: \".concat(\"gold\", \"; color: black; padding: 2px 0.5em; border-radius: 0.5em;\"),\n        ];\n};\nexports.logPrefix = logPrefix;\nvar logLevels = [\"debug\", \"info\", \"error\"];\nvar sdkLogger = function (log, getLogLevel) {\n    if (log === void 0) { log = console.log; }\n    return function (level, message, object) {\n        var allowed = getLogLevel();\n        var allowedValue = logLevels.indexOf(allowed);\n        var currentValue = logLevels.indexOf(level);\n        if (allowed === \"silent\" || currentValue < allowedValue) {\n            return;\n        }\n        var args = __spreadArray(__spreadArray([], (0, exports.logPrefix)(level), true), [message], false);\n        if (object) {\n            args.push(object);\n        }\n        log.apply(void 0, args);\n    };\n};\nexports.getSdkLogger = sdkLogger.bind(null, console.log);\nexports.getSdkLogWithoutTrace = sdkLogger.bind(null, (_a = console._original_log) !== null && _a !== void 0 ? _a : console.log);\n// apply a delta compression to the stats report. Reduces size by ~90%.\n// To reduce further, report keys could be compressed.\n// Muly: maybe can improve using https://github.com/AsyncBanana/microdiff?utm_source=tldrnewsletter\nvar deltaCompression = function (oldStats, newStats) {\n    oldStats = oldStats || {};\n    newStats = newStats || {};\n    newStats = JSON.parse(JSON.stringify(newStats));\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        delete report.id;\n        if (!oldStats[id]) {\n            return;\n        }\n        Object.keys(report).forEach(function (name) {\n            if (report.timestamp && typeof report.timestamp === \"string\") {\n                report.timestamp = new Date(report.timestamp).getTime();\n            }\n            if (report[name] === oldStats[id][name]) {\n                delete newStats[id][name];\n            }\n            else if (Array.isArray(report[name])) {\n                // Arrays get serialized if anything changed.\n                if (JSON.stringify(report[name]) === JSON.stringify(oldStats[id][name])) {\n                    delete newStats[id][name];\n                }\n            }\n            if (Object.keys(report).length === 0) {\n                delete newStats[id];\n            }\n            else if (Object.keys(report).length === 1 && report.timestamp) {\n                delete newStats[id];\n            }\n        });\n    });\n    var timestamp = -Infinity;\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        if (report.timestamp > timestamp) {\n            timestamp = report.timestamp;\n        }\n    });\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        if (report.timestamp === timestamp) {\n            report.timestamp = 0;\n        }\n    });\n    newStats.timestamp = timestamp;\n    return newStats;\n};\nexports.deltaCompression = deltaCompression;\nvar mangleChromeStats = function (pc, response) {\n    var standardReport = {};\n    var reports = response.result();\n    reports.forEach(function (report) {\n        var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp.getTime(),\n            type: report.type,\n        };\n        report.names().forEach(function (name) {\n            standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n    });\n    return standardReport;\n};\nexports.mangleChromeStats = mangleChromeStats;\n// transforms a maplike to an object. Mostly for getStats +\n// JSON.parse(JSON.stringify())\nvar map2obj = function (m) {\n    if (!m.entries) {\n        return m;\n    }\n    var o = {};\n    m.forEach(function (v, k) {\n        o[k] = v;\n    });\n    return o;\n};\nexports.map2obj = map2obj;\nvar dumpStream = function (stream) {\n    return {\n        id: stream.id,\n        tracks: stream.getTracks().map(function (track) {\n            return {\n                id: track.id,\n                kind: track.kind,\n                label: track.label,\n                enabled: track.enabled,\n                muted: track.muted,\n                readyState: track.readyState, // `live` or `ended`\n            };\n        }),\n    };\n};\nexports.dumpStream = dumpStream;\nvar getConnectionData = function (type, key, proxyURL) {\n    var localUrl = \"\".concat(type == \"ws\" ? \"ws\" : \"http\", \"://localhost:9101\");\n    var staging1Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-staging1.testrtc.com\");\n    var staging2Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-staging2.testrtc.com\");\n    var productionUrl = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc.testrtc.com\");\n    var production1Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-app1.testrtc.com\");\n    if (proxyURL && type === \"http\") {\n        if (proxyURL.includes(\"wss://\")) {\n            proxyURL = proxyURL.replace(\"wss://\", \"https://\");\n        }\n        else {\n            proxyURL = proxyURL.replace(\"ws://\", \"http://\");\n        }\n    }\n    var splitted = key.split(\":\");\n    if (key.indexOf(\"local\") !== -1) {\n        return {\n            url: proxyURL || localUrl,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"staging1\") !== -1) {\n        return {\n            url: proxyURL || staging1Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"staging\") !== -1) {\n        return {\n            url: proxyURL || staging2Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"production1\") !== -1) {\n        return {\n            url: proxyURL || production1Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"production\") !== -1) {\n        return {\n            url: proxyURL || productionUrl,\n            key: splitted[1],\n        };\n    }\n    else {\n        return {\n            url: proxyURL || productionUrl,\n            key: splitted[0],\n        };\n    }\n};\nexports.getConnectionData = getConnectionData;\nvar validateConfig = function (config) {\n    if (!(config === null || config === void 0 ? void 0 : config.rtcApiKey)) {\n        (0, sdk_1.sdkLog)(\"debug\", \"config.rtcApiKey or config.rtcToken need to be provided.\");\n        return false;\n    }\n    if (!(config === null || config === void 0 ? void 0 : config.rtcRoomId) || !(config === null || config === void 0 ? void 0 : config.rtcPeerId)) {\n        (0, sdk_1.sdkLog)(\"debug\", \"config.rtcRoomId or config.rtcPeerId is empty.\");\n        return false;\n    }\n    return true;\n};\nexports.validateConfig = validateConfig;\nvar countOfValidConnections = function (openChannels) {\n    return Object.keys(openChannels).filter(function (id) { return openChannels[id].validConnection; }).length;\n};\nexports.countOfValidConnections = countOfValidConnections;\nvar isRoomIdOrPeerIdChanged = function (watchrtcIdentifiers, watchrtcConfig) {\n    var changed = false;\n    if (watchrtcConfig.rtcRoomId &&\n        watchrtcIdentifiers.rtcRoomId &&\n        watchrtcIdentifiers.rtcRoomId !== watchrtcConfig.rtcRoomId) {\n        changed = true;\n    }\n    if (watchrtcConfig.rtcPeerId &&\n        watchrtcIdentifiers.rtcPeerId &&\n        watchrtcIdentifiers.rtcPeerId !== watchrtcConfig.rtcPeerId) {\n        changed = true;\n    }\n    if (changed) {\n        (0, sdk_1.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. rtcRoomId or rtcPeerId has been changed\", {\n            old: {\n                rtcRoomId: watchrtcIdentifiers.rtcRoomId,\n                rtcPeerId: watchrtcIdentifiers.rtcPeerId,\n            },\n            new: {\n                rtcRoomId: watchrtcConfig.rtcRoomId,\n                rtcPeerId: watchrtcConfig.rtcPeerId,\n            },\n        });\n    }\n    return changed;\n};\nexports.isRoomIdOrPeerIdChanged = isRoomIdOrPeerIdChanged;\nvar validateRating = function (rating) {\n    if (!rating) {\n        (0, sdk_1.sdkLog)(\"error\", \"rating parameter is required\");\n        return false;\n    }\n    if (typeof rating !== \"number\" || rating < 1 || rating > 5) {\n        (0, sdk_1.sdkLog)(\"error\", \"rating parameter should be number from 1 to 5\");\n        return false;\n    }\n    return true;\n};\nexports.validateRating = validateRating;\nvar validateEvent = function (event, channels) {\n    if (!event) {\n        (0, sdk_1.sdkLog)(\"error\", \"event parameter is required\");\n        return false;\n    }\n    if (![\"global\", \"local\", \"log\"].includes(event.type)) {\n        (0, sdk_1.sdkLog)(\"error\", \"event.type should be either \\\"global\\\" or \\\"local\\\" or \\\"log\\\"\");\n        return false;\n    }\n    if (event.parameters && typeof event.parameters !== \"object\") {\n        (0, sdk_1.sdkLog)(\"error\", \"event.parameters should be JSON object\\\"\");\n        return false;\n    }\n    if (event.pc && !(event.pc.__rtcStatsId in channels)) {\n        (0, sdk_1.sdkLog)(\"error\", \"event.pc should be a RTCPeerConnection used in the call\\\"\");\n        return false;\n    }\n    return true;\n};\nexports.validateEvent = validateEvent;\nvar getHardwareInfo = function () { return __awaiter(void 0, void 0, void 0, function () {\n    function number_format(num) {\n        return (Math.round(num * 100) / 100).toFixed(2);\n    }\n    var loadBenchmarks, gpuInfo, result, memory;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0:\n                if (typeof window === \"undefined\") {\n                    return [2 /*return*/];\n                }\n                loadBenchmarks = function (fileName) { return __awaiter(void 0, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, new Promise(function (resolve) {\n                                    try {\n                                        var data = require(\"./gpu-benchmarks/\".concat(fileName));\n                                        data.shift();\n                                        return resolve(data);\n                                    }\n                                    catch (err) {\n                                        (0, sdk_1.sdkLog)(\"error\", \"Error. getHardwareInfo. loadBenchmarks\", { err: err.stack, fileName: fileName });\n                                        resolve([]);\n                                    }\n                                })];\n                            case 1: return [2 /*return*/, _a.sent()];\n                        }\n                    });\n                }); };\n                return [4 /*yield*/, GPU.getGPUTier({\n                        override: { loadBenchmarks: loadBenchmarks },\n                    })];\n            case 1:\n                gpuInfo = _a.sent();\n                result = __assign(__assign({}, gpuInfo), { cores_count: window.navigator.hardwareConcurrency });\n                memory = window.performance[\"memory\"];\n                if (memory) {\n                    result.jsHeapSizeLimit = number_format(memory.jsHeapSizeLimit / 1048576);\n                    result.totalJSHeapSize = number_format(memory.totalJSHeapSize / 1048576);\n                    result.usedJSHeapSize = number_format(memory.usedJSHeapSize / 1048576);\n                }\n                return [2 /*return*/, result];\n        }\n    });\n}); };\nexports.getHardwareInfo = getHardwareInfo;\nvar patchConsoleConfig = {\n    originalMethodPrefix: \"_original_\",\n    methodsToPatch: [\"log\", \"debug\", \"info\", \"warn\", \"error\"],\n    level: \"\",\n};\nvar patchConsoleMethod = function (methodName, trace) {\n    var originalMethod = console[methodName];\n    if (!originalMethod) {\n        return;\n    }\n    console[patchConsoleConfig.originalMethodPrefix + methodName] = originalMethod;\n    console[methodName] = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (patchConsoleConfig.level && args.length && trace) {\n            var currentMethodIndex = patchConsoleConfig.methodsToPatch.indexOf(methodName);\n            var configMethodIndex = patchConsoleConfig.methodsToPatch.indexOf(patchConsoleConfig.level);\n            var shouldTraceMethod = currentMethodIndex >= 0 && currentMethodIndex >= configMethodIndex;\n            if (shouldTraceMethod) {\n                var text = stringifyArgs(args);\n                trace({ data: [\"log\", null, { type: methodName, text: text }] });\n            }\n        }\n        originalMethod.apply(console, args);\n    };\n};\nvar setConsoleLevel = function (level, trace) {\n    if (level && patchConsoleConfig.methodsToPatch.includes(level) && level !== patchConsoleConfig.level) {\n        var currentIndex = patchConsoleConfig.methodsToPatch.indexOf(level);\n        var previousIndex = patchConsoleConfig.methodsToPatch.indexOf(patchConsoleConfig.level);\n        if (previousIndex < 0) {\n            for (var _i = 0, _a = patchConsoleConfig.methodsToPatch.slice(currentIndex); _i < _a.length; _i++) {\n                var methodName = _a[_i];\n                patchConsoleMethod(methodName, trace);\n            }\n        }\n        else if (currentIndex < previousIndex) {\n            for (var _b = 0, _c = patchConsoleConfig.methodsToPatch.slice(currentIndex, previousIndex); _b < _c.length; _b++) {\n                var methodName = _c[_b];\n                patchConsoleMethod(methodName, trace);\n            }\n        }\n        patchConsoleConfig.level = level;\n    }\n};\nexports.setConsoleLevel = setConsoleLevel;\nvar restoreOriginalConsoleMethods = function () {\n    if (!(\"console\" in window)) {\n        return;\n    }\n    for (var _i = 0, _a = patchConsoleConfig.methodsToPatch; _i < _a.length; _i++) {\n        var methodName = _a[_i];\n        var originalMethod = console[patchConsoleConfig.originalMethodPrefix + methodName];\n        if (!originalMethod) {\n            continue;\n        }\n        console[methodName] = originalMethod.bind(console);\n        delete console[patchConsoleConfig.originalMethodPrefix + methodName];\n    }\n};\nexports.restoreOriginalConsoleMethods = restoreOriginalConsoleMethods;\nvar exposeApplicationStatsForPC = function (id, previous, current, mappedTradk) {\n    return {\n        peer: (0, stats_1.getTransportFromStats)(id, current),\n        streams: (0, stats_1.getStreamsFromStats)(id, previous, current, mappedTradk),\n    };\n};\nexports.exposeApplicationStatsForPC = exposeApplicationStatsForPC;\nvar stringifyArgs = function (args) {\n    try {\n        return args.map(function (item) { return (typeof item === \"string\" ? item : JSON.stringify(item, replacerFunc())); }).join(\" \");\n    }\n    catch (_a) {\n        // do not log anything to not go into loop\n        // can fail with Illegal Invocation of JSON.stringify\n        // assumption - when customer also uses custom logger and binds another context\n        // so just ignore it\n        return \"\";\n    }\n};\n// avoid \"Converting circular structure to JSON\" error while JSON.stringifying\nvar replacerFunc = function () {\n    var visited = new WeakSet();\n    return function (_key, value) {\n        if (typeof value === \"object\" && value !== null) {\n            if (visited.has(value)) {\n                return;\n            }\n            visited.add(value);\n        }\n        return value;\n    };\n};\nvar applyPatchForRTT = function (oldStats, newStats) {\n    oldStats = oldStats || {};\n    newStats = newStats || {};\n    var hasOldStats = true;\n    if (Object.keys(oldStats).length === 0) {\n        hasOldStats = false;\n    }\n    var keys = Object.keys(newStats);\n    var reportKeys = keys.filter(function (key) { return newStats[key].type === \"remote-outbound-rtp\" || newStats[key].type === \"remote-inbound-rtp\"; });\n    reportKeys.forEach(function (reportKey) {\n        // case for Firefox/Safari\n        if (!(\"roundTripTime\" in newStats[reportKey])) {\n            newStats[reportKey].roundTripTime = NaN;\n        }\n        else {\n            // case Chrome\n            var statsHaveRTTMeasurements = \"roundTripTimeMeasurements\" in newStats[reportKey] &&\n                Boolean(oldStats[reportKey]) &&\n                \"roundTripTimeMeasurements\" in oldStats[reportKey];\n            if (hasOldStats && statsHaveRTTMeasurements) {\n                if (newStats[reportKey].roundTripTimeMeasurements === oldStats[reportKey].roundTripTimeMeasurements) {\n                    newStats[reportKey].roundTripTime = NaN;\n                }\n            }\n        }\n    });\n    return newStats;\n};\nexports.applyPatchForRTT = applyPatchForRTT;\nvar subtractNailUpReferenceStats = function (referenceStats, newStats) {\n    var _loop_1 = function (key, report) {\n        if (key in referenceStats) {\n            var referenceReport_1 = referenceStats[key];\n            switch (report.type) {\n                case \"inbound-rtp\":\n                    [\n                        \"bytesReceived\",\n                        \"packetsReceived\",\n                        \"packetsLost\",\n                        \"framesDecoded\",\n                        \"keyFramesDecoded\",\n                        \"framesRendered\",\n                        \"framesDropped\",\n                        \"qpSum\",\n                        \"totalDecodeTime\",\n                        \"totalInterFrameDelay\",\n                        \"totalSquaredInterFrameDelay\",\n                        \"pauseCount\",\n                        \"totalPausesDuration\",\n                        \"freezeCount\",\n                        \"totalFreezesDuration\",\n                        \"headerBytesReceived\",\n                        \"packetsDiscarded\",\n                        \"fecBytesReceived\",\n                        \"fecPacketsReceived\",\n                        \"fecPacketsDiscarded\",\n                        \"firCount\",\n                        \"pliCount\",\n                        \"totalProcessingDelay\",\n                        \"nackCount\",\n                        \"jitterBufferEmittedCount\",\n                        \"totalSamplesReceived\",\n                        \"concealedSamples\",\n                        \"silentConcealedSamples\",\n                        \"concealmentEvents\",\n                        \"totalAudioEnergy\",\n                        \"totalSamplesDuration\",\n                        \"framesReceived\",\n                        \"framesAssembledFromMultiplePackets\",\n                        \"totalAssemblyTime\",\n                        \"retransmittedPacketsReceived\",\n                        \"retransmittedBytesReceived\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"outbound-rtp\":\n                    [\n                        \"packetsSent\",\n                        \"bytesSent\",\n                        \"headerBytesSent\",\n                        \"retransmittedPacketsSent\",\n                        \"retransmittedBytesSent\",\n                        \"totalEncodedBytesTarget\",\n                        \"framesSent\",\n                        \"hugeFramesSent\",\n                        \"framesEncoded\",\n                        \"keyFramesEncoded\",\n                        \"qpSum\",\n                        \"totalEncodeTime\",\n                        \"totalPacketsSendDelay\",\n                        \"qualityLimitationResolutionChanges\",\n                        \"qualityLimitationDurations\",\n                        \"nackCount\",\n                        \"firCount\",\n                        \"pliCount\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            if (stat === \"qualityLimitationDurations\") {\n                                report[stat].bandwidth = Math.max(report[stat].bandwidth - referenceReport_1[stat].bandwidth, 0);\n                                report[stat].cpu = Math.max(report[stat].cpu - referenceReport_1[stat].cpu, 0);\n                                report[stat].other = Math.max(report[stat].other - referenceReport_1[stat].other, 0);\n                                report[stat].none = Math.max(report[stat].none - referenceReport_1[stat].none, 0);\n                            }\n                            else {\n                                report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                            }\n                        }\n                    });\n                    break;\n                case \"remote-inbound-rtp\":\n                    [\"packetsReceived\", \"packetsLost\", \"totalRoundTripTime\", \"roundTripTimeMeasurements\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"remote-outbound-rtp\":\n                    [\"packetsSent\", \"bytesSent\", \"totalRoundTripTime\", \"roundTripTimeMeasurements\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"media-source\":\n                    [\n                        \"totalAudioEnergy\",\n                        \"totalSamplesDuration\",\n                        \"droppedSamplesDuration\",\n                        \"droppedSamplesEvents\",\n                        \"totalCaptureDelay\",\n                        \"totalSamplesCaptured\",\n                        \"frames\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"media-playout\":\n                    [\n                        \"synthesizedSamplesDuration\",\n                        \"synthesizedSamplesEvents\",\n                        \"totalSamplesDuration\",\n                        \"totalPlayoutDelay\",\n                        \"totalSamplesCount\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"peer-connection\":\n                    [\"dataChannelsOpened\", \"dataChannelsClosed\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"data-channel\":\n                    [\"messagesSent\", \"bytesSent\", \"messagesReceived\", \"bytesReceived\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"transport\":\n                    [\"packetsSent\", \"packetsReceived\", \"bytesSent\", \"bytesReceived\", \"selectedCandidatePairChanges\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"candidate-pair\":\n                    [\n                        \"packetsSent\",\n                        \"packetsReceived\",\n                        \"bytesSent\",\n                        \"bytesReceived\",\n                        \"totalRoundTripTime\",\n                        \"requestsReceived\",\n                        \"requestsSent\",\n                        \"responsesReceived\",\n                        \"responsesSent\",\n                        \"consentRequestsSent\",\n                        \"packetsDiscardedOnSend\",\n                        \"bytesDiscardedOnSend\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                default:\n                    break;\n            }\n        }\n    };\n    for (var _i = 0, _a = Object.entries(newStats); _i < _a.length; _i++) {\n        var _b = _a[_i], key = _b[0], report = _b[1];\n        _loop_1(key, report);\n    }\n    return newStats;\n};\nexports.subtractNailUpReferenceStats = subtractNailUpReferenceStats;\nvar generateID = function () {\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n};\nexports.generateID = generateID;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = \"1.38.2\";\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar sdk_1 = require(\"./sdk\");\nvar WatchRTCHttp = /** @class */ (function () {\n    function WatchRTCHttp() {\n        if (WatchRTCHttp._instance) {\n            (0, sdk_1.sdkLog)(\"info\", \"WatchRTCSocket instance already created\");\n        }\n        else {\n            WatchRTCHttp._instance = this;\n        }\n    }\n    WatchRTCHttp.prototype.trace = function (url, projectId, rtcRoomId, rtcPeerId) {\n        var data = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            data[_i - 4] = arguments[_i];\n        }\n        var args = Array.prototype.slice.call(data);\n        args.push(Date.now());\n        if (args[1] instanceof RTCPeerConnection) {\n            args[1] = args[1].__rtcStatsId;\n        }\n        var response = fetch(url, {\n            method: \"POST\",\n            mode: \"cors\",\n            cache: \"no-cache\",\n            credentials: \"same-origin\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                data: data,\n                projectId: projectId,\n                rtcRoomId: rtcRoomId,\n                rtcPeerId: rtcPeerId,\n            }),\n        });\n        return response\n            .then(function () { return ({}); })\n            .catch(function (err) {\n            (0, sdk_1.sdkLog)(\"error\", err.message, { err: err.stack });\n            return { error: err };\n        });\n    };\n    return WatchRTCHttp;\n}());\nexports.default = WatchRTCHttp;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar sdk_1 = require(\"./sdk\");\nvar LZString = require(\"./lz-string\");\nvar PROTOCOL_VERSION = \"2.0\";\nvar MSG_TIME_DIFF_THRESHLOD = 12 * 60 * 60 * 1000; // 12 hours\nvar isBrowser = typeof window !== \"undefined\";\nvar globalContext = isBrowser ? window : global;\nvar WatchRTCSocket = /** @class */ (function () {\n    function WatchRTCSocket() {\n        var _this_1 = this;\n        this.connection = null;\n        this.wasConnected = false;\n        this.buffer = [];\n        this.sendInterval = 1;\n        this.onClose = function () { };\n        this.dataCollection = true;\n        this.sendPromises = [];\n        this.prevMessageTs = Date.now();\n        this.trace = function (_a) {\n            var data = _a.data, options = _a.options;\n            var args = Array.prototype.slice.call(data);\n            var prevMessageTs = _this_1.prevMessageTs;\n            var now = Date.now();\n            var timeSinceLastMessage = now - prevMessageTs;\n            if (Math.abs(timeSinceLastMessage) >= MSG_TIME_DIFF_THRESHLOD) {\n                _this_1.trace({ data: [\"timeChange\", null, { now: now, prevMessageTs: prevMessageTs, timeSinceLastMessage: timeSinceLastMessage }] });\n            }\n            args.push(now);\n            if (args[1] instanceof RTCPeerConnection) {\n                args[1] = args[1].__rtcStatsId;\n            }\n            if (!WatchRTCSocket._instance.dataCollection) {\n                if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                    options.promiseFuncs.resolve({ error: \"Data collection disabled\" });\n                }\n                return;\n            }\n            // Don't store a new message if the connection is not open and the buffer is full (> 1000 messages)\n            if (!WatchRTCSocket._instance.connection ||\n                WatchRTCSocket._instance.connection.readyState !== globalContext.WebSocket.OPEN) {\n                if (WatchRTCSocket._instance.buffer.length > 1000) {\n                    if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                        options.promiseFuncs.resolve({ error: \"Message buffer size exceeded\" });\n                    }\n                    return;\n                }\n            }\n            // Else, store the message in the buffer\n            WatchRTCSocket._instance.buffer.push(args);\n            if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                WatchRTCSocket._instance.sendPromises.push(options.promiseFuncs);\n            }\n            // If the connection is open and the buffer threshold is reached, send the messages\n            if (WatchRTCSocket._instance.connection &&\n                WatchRTCSocket._instance.connection.readyState === globalContext.WebSocket.OPEN) {\n                if (WatchRTCSocket._instance.buffer.length >= WatchRTCSocket._instance.sendInterval) {\n                    var lines = JSON.stringify(WatchRTCSocket._instance.buffer);\n                    var compressedMessage = LZString.compressToEncodedURIComponent(lines);\n                    (0, sdk_1.sdkLogWithoutTrace)(\"debug\", \"lines: \".concat(lines.length));\n                    (0, sdk_1.sdkLogWithoutTrace)(\"debug\", \"compressedMessage: \".concat(compressedMessage.length));\n                    WatchRTCSocket._instance.buffer = [];\n                    WatchRTCSocket._instance.connection.send(compressedMessage);\n                    WatchRTCSocket._instance.sendPromises.forEach(function (_a) {\n                        var resolve = _a.resolve;\n                        return resolve({});\n                    });\n                    WatchRTCSocket._instance.sendPromises = [];\n                }\n            }\n        };\n        if (WatchRTCSocket._instance) {\n            (0, sdk_1.sdkLog)(\"info\", \"WatchRTCSocket instance already created\");\n        }\n        else {\n            WatchRTCSocket._instance = this;\n        }\n    }\n    WatchRTCSocket.prototype.connect = function (_a) {\n        var url = _a.url, onData = _a.onData, onError = _a.onError, onOpen = _a.onOpen, onClose = _a.onClose, _b = _a.options, options = _b === void 0 ? {} : _b;\n        var cleanOldTraces = options.cleanOldTraces;\n        if (WatchRTCSocket._instance.connection) {\n            WatchRTCSocket._instance.connection.close();\n            WatchRTCSocket._instance.connection = null;\n        }\n        var _this = WatchRTCSocket._instance;\n        if (cleanOldTraces) {\n            // we want to keep last 10 minutes of logs, to prevent old logs timestamp impacting actual session duration\n            var timeThreshold_1 = Date.now() - 10 * 60 * 1000; // 10 min\n            var relevantTraces = _this.buffer.filter(function (data) { return data[3] > timeThreshold_1; });\n            var filteredCount = _this.buffer.length - relevantTraces.length;\n            _this.buffer = relevantTraces;\n            var args = [\"oldTracesCleanup\", null, { filteredCount: filteredCount }, Date.now()];\n            (0, sdk_1.sdkLog)(\"info\", \"watchRTC SDK flushed \".concat(filteredCount, \" messages\"));\n            _this.buffer.push(args);\n        }\n        WatchRTCSocket._instance.connection = new globalContext.WebSocket(url, PROTOCOL_VERSION);\n        WatchRTCSocket._instance.connection.onopen = onOpen || null;\n        WatchRTCSocket._instance.connection.onclose = onClose || null;\n        WatchRTCSocket._instance.connection.onmessage = function (e) {\n            var _a;\n            try {\n                var data = JSON.parse(e.data);\n                if (data.error) {\n                    (_a = _this === null || _this === void 0 ? void 0 : _this.connection) === null || _a === void 0 ? void 0 : _a.close();\n                    _this.connection = null;\n                    (0, sdk_1.sdkLog)(\"error\", \"\\n\" + data.error);\n                    onError(data.error, \"auth\");\n                }\n                else {\n                    if (data.sendInterval) {\n                        WatchRTCSocket._instance.sendInterval = data.sendInterval;\n                    }\n                    onData(data);\n                    WatchRTCSocket._instance.wasConnected = true;\n                }\n            }\n            catch (err) {\n                (0, sdk_1.sdkLog)(\"error\", \"\\n\", { err: err.stack });\n                onError(err.message);\n            }\n        };\n        WatchRTCSocket._instance.connection.onerror = function (e) {\n            (0, sdk_1.sdkLog)(\"error\", \"\\n\", e);\n            onError(e, \"connection\");\n        };\n    };\n    WatchRTCSocket.prototype.close = function (nailUpCallEnd) {\n        var _a, _b;\n        if (nailUpCallEnd && ((_b = (_a = WatchRTCSocket._instance) === null || _a === void 0 ? void 0 : _a.connection) === null || _b === void 0 ? void 0 : _b.readyState) === globalContext.WebSocket.OPEN) {\n            var lines = JSON.stringify([\"nailUpCallEnd\", null, null, Date.now()]);\n            var compressedMessage = LZString.compressToEncodedURIComponent(lines);\n            WatchRTCSocket._instance.connection.send(compressedMessage);\n        }\n        WatchRTCSocket._instance.buffer = [];\n        WatchRTCSocket._instance.sendPromises.forEach(function (_a) {\n            var resolve = _a.resolve;\n            return resolve({ error: \"Connection was close\" });\n        });\n        WatchRTCSocket._instance.sendPromises = [];\n        if (WatchRTCSocket._instance.connection) {\n            WatchRTCSocket._instance.connection.close();\n            WatchRTCSocket._instance.onClose();\n            WatchRTCSocket._instance.connection = null;\n        }\n    };\n    WatchRTCSocket.prototype.disableDataCollection = function () {\n        (0, sdk_1.sdkLog)(\"debug\", \"Data collection disabled.\");\n        WatchRTCSocket._instance.dataCollection = false;\n    };\n    WatchRTCSocket.prototype.enableDataCollection = function () {\n        (0, sdk_1.sdkLog)(\"debug\", \"Data collection enabled.\");\n        WatchRTCSocket._instance.dataCollection = true;\n    };\n    WatchRTCSocket.prototype.isDisabledDataCollection = function () {\n        return !WatchRTCSocket._instance.dataCollection;\n    };\n    return WatchRTCSocket;\n}());\nexports.default = WatchRTCSocket;\n","!(function (e, r) {\n  \"object\" == typeof exports && \"undefined\" != typeof module\n    ? r(exports)\n    : \"function\" == typeof define && define.amd\n    ? define([\"exports\"], r)\n    : r(((e = \"undefined\" != typeof globalThis ? globalThis : e || self).DetectGPU = {}));\n})(this, function (e) {\n  \"use strict\";\n  var r = function (e, n) {\n    return (r =\n      Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array &&\n        function (e, r) {\n          e.__proto__ = r;\n        }) ||\n      function (e, r) {\n        for (var n in r) Object.prototype.hasOwnProperty.call(r, n) && (e[n] = r[n]);\n      })(e, n);\n  };\n  function n(e, r, n, t) {\n    return new (n || (n = Promise))(function (o, a) {\n      function i(e) {\n        try {\n          u(t.next(e));\n        } catch (e) {\n          a(e);\n        }\n      }\n      function c(e) {\n        try {\n          u(t.throw(e));\n        } catch (e) {\n          a(e);\n        }\n      }\n      function u(e) {\n        var r;\n        e.done\n          ? o(e.value)\n          : ((r = e.value),\n            r instanceof n\n              ? r\n              : new n(function (e) {\n                  e(r);\n                })).then(i, c);\n      }\n      u((t = t.apply(e, r || [])).next());\n    });\n  }\n  function t(e, r) {\n    var n,\n      t,\n      o,\n      a,\n      i = {\n        label: 0,\n        sent: function () {\n          if (1 & o[0]) throw o[1];\n          return o[1];\n        },\n        trys: [],\n        ops: [],\n      };\n    return (\n      (a = { next: c(0), throw: c(1), return: c(2) }),\n      \"function\" == typeof Symbol &&\n        (a[Symbol.iterator] = function () {\n          return this;\n        }),\n      a\n    );\n    function c(a) {\n      return function (c) {\n        return (function (a) {\n          if (n) throw new TypeError(\"Generator is already executing.\");\n          for (; i; )\n            try {\n              if (\n                ((n = 1),\n                t &&\n                  (o = 2 & a[0] ? t.return : a[0] ? t.throw || ((o = t.return) && o.call(t), 0) : t.next) &&\n                  !(o = o.call(t, a[1])).done)\n              )\n                return o;\n              switch (((t = 0), o && (a = [2 & a[0], o.value]), a[0])) {\n                case 0:\n                case 1:\n                  o = a;\n                  break;\n                case 4:\n                  return i.label++, { value: a[1], done: !1 };\n                case 5:\n                  i.label++, (t = a[1]), (a = [0]);\n                  continue;\n                case 7:\n                  (a = i.ops.pop()), i.trys.pop();\n                  continue;\n                default:\n                  if (!((o = i.trys), (o = o.length > 0 && o[o.length - 1]) || (6 !== a[0] && 2 !== a[0]))) {\n                    i = 0;\n                    continue;\n                  }\n                  if (3 === a[0] && (!o || (a[1] > o[0] && a[1] < o[3]))) {\n                    i.label = a[1];\n                    break;\n                  }\n                  if (6 === a[0] && i.label < o[1]) {\n                    (i.label = o[1]), (o = a);\n                    break;\n                  }\n                  if (o && i.label < o[2]) {\n                    (i.label = o[2]), i.ops.push(a);\n                    break;\n                  }\n                  o[2] && i.ops.pop(), i.trys.pop();\n                  continue;\n              }\n              a = r.call(e, i);\n            } catch (e) {\n              (a = [6, e]), (t = 0);\n            } finally {\n              n = o = 0;\n            }\n          if (5 & a[0]) throw a[1];\n          return { value: a[0] ? a[1] : void 0, done: !0 };\n        })([a, c]);\n      };\n    }\n  }\n  var o = [\n    \"geforce 320m\",\n    \"geforce 8600\",\n    \"geforce 8600m gt\",\n    \"geforce 8800 gs\",\n    \"geforce 8800 gt\",\n    \"geforce 9400\",\n    \"geforce 9400m g\",\n    \"geforce 9400m\",\n    \"geforce 9600m gt\",\n    \"geforce 9600m\",\n    \"geforce fx go5200\",\n    \"geforce gt 120\",\n    \"geforce gt 130\",\n    \"geforce gt 330m\",\n    \"geforce gtx 285\",\n    \"google swiftshader\",\n    \"intel g41\",\n    \"intel g45\",\n    \"intel gma 4500mhd\",\n    \"intel gma x3100\",\n    \"intel hd 3000\",\n    \"intel q45\",\n    \"legacy\",\n    \"mali-2\",\n    \"mali-3\",\n    \"mali-4\",\n    \"quadro fx 1500\",\n    \"quadro fx 4\",\n    \"quadro fx 5\",\n    \"radeon hd 2400\",\n    \"radeon hd 2600\",\n    \"radeon hd 4670\",\n    \"radeon hd 4850\",\n    \"radeon hd 4870\",\n    \"radeon hd 5670\",\n    \"radeon hd 5750\",\n    \"radeon hd 6290\",\n    \"radeon hd 6300\",\n    \"radeon hd 6310\",\n    \"radeon hd 6320\",\n    \"radeon hd 6490m\",\n    \"radeon hd 6630m\",\n    \"radeon hd 6750m\",\n    \"radeon hd 6770m\",\n    \"radeon hd 6970m\",\n    \"sgx 543\",\n    \"sgx543\",\n  ];\n  function a(e) {\n    return (e = e\n      .toLowerCase()\n      .replace(/^angle ?\\((.+)\\)*$/, \"$1\")\n      .replace(/\\s(\\d{1,2}gb|direct3d.+$)|\\(r\\)| \\([^)]+\\)$/g, \"\"));\n  }\n  const i = 34962;\n  var c = \"undefined\" == typeof window,\n    u = (function () {\n      if (!c) {\n        var e = window.navigator,\n          r = e.userAgent,\n          n = e.platform,\n          t = e.maxTouchPoints,\n          o = /(iphone|ipod|ipad)/i.test(r),\n          a = \"iPad\" === n || (\"MacIntel\" === n && t > 0 && !window.MSStream);\n        return { isIpad: a, isMobile: /android/i.test(r) || o || a, isSafari12: /Version\\/12.+Safari/.test(r) };\n      }\n    })();\n  function f(e, r, n) {\n    if (!n) return [r];\n    var t,\n      o = (function (e) {\n        var r =\n            \"\\n    precision highp float;\\n    attribute vec3 aPosition;\\n    varying float vvv;\\n    void main() {\\n      vvv = 0.31622776601683794;\\n      gl_Position = vec4(aPosition, 1.0);\\n    }\\n  \",\n          n =\n            \"\\n    precision highp float;\\n    varying float vvv;\\n    void main() {\\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\\n      enc = fract(enc);\\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\\n      gl_FragColor = enc;\\n    }\\n  \",\n          t = e.createShader(35633),\n          o = e.createShader(35632),\n          a = e.createProgram();\n        if (!(o && t && a)) return;\n        e.shaderSource(t, r),\n          e.shaderSource(o, n),\n          e.compileShader(t),\n          e.compileShader(o),\n          e.attachShader(a, t),\n          e.attachShader(a, o),\n          e.linkProgram(a),\n          e.detachShader(a, t),\n          e.detachShader(a, o),\n          e.deleteShader(t),\n          e.deleteShader(o),\n          e.useProgram(a);\n        var c = e.createBuffer();\n        e.bindBuffer(i, c), e.bufferData(i, new Float32Array([-1, -1, 0, 3, -1, 0, -1, 3, 0]), 35044);\n        var u = e.getAttribLocation(a, \"aPosition\");\n        e.vertexAttribPointer(u, 3, 5126, !1, 0, 0),\n          e.enableVertexAttribArray(u),\n          e.clearColor(1, 1, 1, 1),\n          e.clear(16384),\n          e.viewport(0, 0, 1, 1),\n          e.drawArrays(4, 0, 3);\n        var f = new Uint8Array(4);\n        return e.readPixels(0, 0, 1, 1, 6408, 5121, f), e.deleteProgram(a), e.deleteBuffer(c), f.join(\"\");\n      })(e),\n      a = \"801621810\",\n      c = \"8016218135\",\n      f = \"80162181161\",\n      l = (null == u ? void 0 : u.isIpad)\n        ? [\n            [\"a7\", f, 12],\n            [\"a8\", c, 15],\n            [\"a8x\", c, 15],\n            [\"a9\", c, 15],\n            [\"a9x\", c, 15],\n            [\"a10\", c, 15],\n            [\"a10x\", c, 15],\n            [\"a12\", a, 15],\n            [\"a12x\", a, 15],\n            [\"a12z\", a, 15],\n            [\"a14\", a, 15],\n            [\"m1\", a, 15],\n          ]\n        : [\n            [\"a7\", f, 12],\n            [\"a8\", c, 12],\n            [\"a9\", c, 15],\n            [\"a10\", c, 15],\n            [\"a11\", a, 15],\n            [\"a12\", a, 15],\n            [\"a13\", a, 15],\n            [\"a14\", a, 15],\n          ];\n    return (\n      \"80162181255\" === o\n        ? (t = l.filter(function (e) {\n            return e[2] >= 14;\n          }))\n        : (t = l.filter(function (e) {\n            return e[1] === o;\n          })).length || (t = l),\n      t.map(function (e) {\n        var r = e[0];\n        return \"apple \".concat(r, \" gpu\");\n      })\n    );\n  }\n  var l = [],\n    d = [];\n  function s(e, r) {\n    if (e === r) return 0;\n    var n = e;\n    e.length > r.length && ((e = r), (r = n));\n    for (var t = e.length, o = r.length; t > 0 && e.charCodeAt(~-t) === r.charCodeAt(~-o); ) t--, o--;\n    for (var a, i = 0; i < t && e.charCodeAt(i) === r.charCodeAt(i); ) i++;\n    if (((o -= i), 0 === (t -= i))) return o;\n    for (var c, u, f = 0, s = 0, h = 0; s < t; ) (d[s] = e.charCodeAt(i + s)), (l[s] = ++s);\n    for (; h < o; )\n      for (a = r.charCodeAt(i + h), c = h++, f = h, s = 0; s < t; s++)\n        (u = a === d[s] ? c : c + 1), (c = l[s]), (f = l[s] = c > f ? (u > f ? f + 1 : u) : u > c ? c + 1 : u);\n    return f;\n  }\n  function h(e) {\n    return null != e;\n  }\n  var v = (function (e) {\n    function n(r) {\n      var n = this.constructor,\n        t = e.call(this, r) || this;\n      return Object.setPrototypeOf(t, n.prototype), t;\n    }\n    return (\n      (function (e, n) {\n        if (\"function\" != typeof n && null !== n)\n          throw new TypeError(\"Class extends value \" + String(n) + \" is not a constructor or null\");\n        function t() {\n          this.constructor = e;\n        }\n        r(e, n), (e.prototype = null === n ? Object.create(n) : ((t.prototype = n.prototype), new t()));\n      })(n, e),\n      n\n    );\n  })(Error);\n  (e.getGPUTier = function (e) {\n    var r = void 0 === e ? {} : e,\n      i = r.mobileTiers,\n      l = void 0 === i ? [0, 15, 30, 60] : i,\n      d = r.desktopTiers,\n      p = void 0 === d ? [0, 15, 30, 60] : d,\n      g = r.override,\n      m = void 0 === g ? {} : g,\n      b = r.glContext,\n      w = r.failIfMajorPerformanceCaveat,\n      y = void 0 !== w && w,\n      x = r.benchmarksURL,\n      P = void 0 === x ? \"https://unpkg.com/detect-gpu@\".concat(\"4.0.8\", \"/dist/benchmarks\") : x;\n    return n(void 0, void 0, void 0, function () {\n      var e, r, i, d, g, w, x, A, S, _, C, E, L, M, j, B, k, O, T, U, I, D, R, G, N, K;\n      return t(this, function (W) {\n        switch (W.label) {\n          case 0:\n            if (((e = {}), c)) return [2, { tier: 0, type: \"SSR\" }];\n            if (\n              ((r = m.isIpad),\n              (i = void 0 === r ? !!(null == u ? void 0 : u.isIpad) : r),\n              (d = m.isMobile),\n              (g = void 0 === d ? !!(null == u ? void 0 : u.isMobile) : d),\n              (w = m.screenSize),\n              (x = void 0 === w ? window.screen : w),\n              (A = m.loadBenchmarks),\n              (S =\n                void 0 === A\n                  ? function (e) {\n                      return n(void 0, void 0, void 0, function () {\n                        var r;\n                        return t(this, function (n) {\n                          switch (n.label) {\n                            case 0:\n                              return [\n                                4,\n                                fetch(\"\".concat(P, \"/\").concat(e)).then(function (e) {\n                                  return e.json();\n                                }),\n                              ];\n                            case 1:\n                              if (((r = n.sent()), parseInt(r.shift().split(\".\")[0], 10) < 4))\n                                throw new v(\"Detect GPU benchmark data is out of date. Please update to version 4x\");\n                              return [2, r];\n                          }\n                        });\n                      });\n                    }\n                  : A),\n              (_ = m.renderer),\n              (C = function (e) {\n                for (\n                  var r = 0,\n                    n = g\n                      ? [\"adreno\", \"apple\", \"mali-t\", \"mali\", \"nvidia\", \"powervr\"]\n                      : [\"intel\", \"apple\", \"amd\", \"radeon\", \"nvidia\", \"geforce\"];\n                  r < n.length;\n                  r++\n                ) {\n                  var t = n[r];\n                  if (e.includes(t)) return t;\n                }\n              }),\n              (E = function (r) {\n                return n(void 0, void 0, void 0, function () {\n                  var n, o, a, c, u, f, l, d, h, p, m, b, w, y, P, A, _, E, L, M, j, B, k, O, T, U;\n                  return t(this, function (t) {\n                    switch (t.label) {\n                      case 0:\n                        if (!(n = C(r))) return [2];\n                        (o = \"\"\n                          .concat(g ? \"m\" : \"d\", \"-\")\n                          .concat(n)\n                          .concat(i ? \"-ipad\" : \"\", \".json\")),\n                          (a = e[o] = null !== (U = e[o]) && void 0 !== U ? U : S(o)),\n                          (t.label = 1);\n                      case 1:\n                        return t.trys.push([1, 3, , 4]), [4, a];\n                      case 2:\n                        return (c = t.sent()), [3, 4];\n                      case 3:\n                        if ((u = t.sent()) instanceof v) throw u;\n                        return [2];\n                      case 4:\n                        if (\n                          ((f = (function (e) {\n                            var r,\n                              n =\n                                (e = e.replace(/\\([^)]+\\)/, \"\")).match(/\\d+/) ||\n                                e.match(/(\\W|^)([A-Za-z]{1,3})(\\W|$)/g);\n                            return null !== (r = null == n ? void 0 : n.join(\"\").replace(/\\W|amd/g, \"\")) && void 0 !== r\n                              ? r\n                              : \"\";\n                          })(r)),\n                          (l = c.filter(function (e) {\n                            return e[1] === f;\n                          })).length ||\n                            (l = c.filter(function (e) {\n                              return e[0].includes(r);\n                            })),\n                          0 === (d = l.length))\n                        )\n                          return [2];\n                        for (\n                          h =\n                            d > 1\n                              ? l\n                                  .map(function (e) {\n                                    return [e, s(r, e[0])];\n                                  })\n                                  .sort(function (e, r) {\n                                    return e[1] - r[1];\n                                  })[0][0]\n                              : l[0],\n                            p = h[0],\n                            m = h[3],\n                            b = Number.MAX_VALUE,\n                            y = window.devicePixelRatio,\n                            P = x.width * y * x.height * y,\n                            A = 0,\n                            _ = m;\n                          A < _.length;\n                          A++\n                        )\n                          (E = _[A]),\n                            (L = E[0]),\n                            (M = E[1]),\n                            (j = L * M),\n                            (B = Math.abs(P - j)) < b && ((b = B), (w = E));\n                        return w ? ((O = (k = w)[2]), (T = k[3]), [2, [b, O, p, T]]) : [2];\n                    }\n                  });\n                });\n              }),\n              (L = function (e, r, n, t, o) {\n                return { device: o, fps: t, gpu: n, isMobile: g, tier: e, type: r };\n              }),\n              (j = \"\"),\n              _)\n            )\n              (_ = a(_)), (M = [_]);\n            else {\n              if (\n                !(B =\n                  b ||\n                  (function (e, r) {\n                    void 0 === r && (r = !1);\n                    var n = {\n                      alpha: !1,\n                      antialias: !1,\n                      depth: !1,\n                      failIfMajorPerformanceCaveat: r,\n                      powerPreference: \"high-performance\",\n                      stencil: !1,\n                    };\n                    e && delete n.powerPreference;\n                    var t = window.document.createElement(\"canvas\"),\n                      o = t.getContext(\"webgl\", n) || t.getContext(\"experimental-webgl\", n);\n                    return null != o ? o : void 0;\n                  })(null == u ? void 0 : u.isSafari12, y))\n              )\n                return [2, L(0, \"WEBGL_UNSUPPORTED\")];\n              if (\n                ((k = B.getExtension(\"WEBGL_debug_renderer_info\")) && (_ = B.getParameter(k.UNMASKED_RENDERER_WEBGL)),\n                !_)\n              )\n                return [2, L(1, \"FALLBACK\")];\n              (j = _),\n                (_ = a(_)),\n                (M = (function (e, r, n) {\n                  return \"apple gpu\" === r ? f(e, r, n) : [r];\n                })(B, _, g));\n            }\n            return [4, Promise.all(M.map(E))];\n          case 1:\n            if (\n              !(O = W.sent()\n                .filter(h)\n                .sort(function (e, r) {\n                  var n = e[0],\n                    t = void 0 === n ? Number.MAX_VALUE : n,\n                    o = e[1],\n                    a = r[0],\n                    i = void 0 === a ? Number.MAX_VALUE : a,\n                    c = r[1];\n                  return t === i ? o - c : t - i;\n                })).length\n            )\n              return [\n                2,\n                (T = o.find(function (e) {\n                  return _.includes(e);\n                }))\n                  ? L(0, \"BLOCKLISTED\", T)\n                  : L(1, \"FALLBACK\", \"\".concat(_, \" (\").concat(j, \")\")),\n              ];\n            if (((U = O[0]), (I = U[1]), (D = U[2]), (R = U[3]), -1 === I)) return [2, L(0, \"BLOCKLISTED\", D, I, R)];\n            for (G = g ? l : p, N = 0, K = 0; K < G.length; K++) I >= G[K] && (N = K);\n            return [2, L(N, \"BENCHMARK\", D, I, R)];\n        }\n      });\n    });\n  }),\n    Object.defineProperty(e, \"__esModule\", { value: !0 });\n});\n//# sourceMappingURL=detect-gpu.umd.js.map\n","var map = {\n\t\"./d-adreno.json\": 622,\n\t\"./d-amd.json\": 183,\n\t\"./d-apple.json\": 732,\n\t\"./d-geforce.json\": 405,\n\t\"./d-intel.json\": 178,\n\t\"./d-nvidia.json\": 217,\n\t\"./d-radeon.json\": 145,\n\t\"./m-adreno.json\": 921,\n\t\"./m-apple-ipad.json\": 535,\n\t\"./m-apple.json\": 438,\n\t\"./m-intel.json\": 283,\n\t\"./m-mali-t.json\": 327,\n\t\"./m-mali.json\": 538,\n\t\"./m-nvidia.json\": 884,\n\t\"./m-powervr.json\": 214\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 804;","var LZString = (function () {\n  function o(o, r) {\n    if (!t[o]) {\n      t[o] = {};\n      for (var n = 0; n < o.length; n++) t[o][o.charAt(n)] = n;\n    }\n    return t[o][r];\n  }\n  var r = String.fromCharCode,\n    n = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    e = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\",\n    t = {},\n    i = {\n      compressToBase64: function (o) {\n        if (null == o) return \"\";\n        var r = i._compress(o, 6, function (o) {\n          return n.charAt(o);\n        });\n        switch (r.length % 4) {\n          default:\n          case 0:\n            return r;\n          case 1:\n            return r + \"===\";\n          case 2:\n            return r + \"==\";\n          case 3:\n            return r + \"=\";\n        }\n      },\n      decompressFromBase64: function (r) {\n        return null == r\n          ? \"\"\n          : \"\" == r\n          ? null\n          : i._decompress(r.length, 32, function (e) {\n              return o(n, r.charAt(e));\n            });\n      },\n      compressToUTF16: function (o) {\n        return null == o\n          ? \"\"\n          : i._compress(o, 15, function (o) {\n              return r(o + 32);\n            }) + \" \";\n      },\n      decompressFromUTF16: function (o) {\n        return null == o\n          ? \"\"\n          : \"\" == o\n          ? null\n          : i._decompress(o.length, 16384, function (r) {\n              return o.charCodeAt(r) - 32;\n            });\n      },\n      compressToUint8Array: function (o) {\n        for (\n          var r = i.compress(o), n = new Uint8Array(2 * r.length), e = 0, t = r.length;\n          t > e;\n          e++\n        ) {\n          var s = r.charCodeAt(e);\n          (n[2 * e] = s >>> 8), (n[2 * e + 1] = s % 256);\n        }\n        return n;\n      },\n      decompressFromUint8Array: function (o) {\n        if (null === o || void 0 === o) return i.decompress(o);\n        for (var n = new Array(o.length / 2), e = 0, t = n.length; t > e; e++)\n          n[e] = 256 * o[2 * e] + o[2 * e + 1];\n        var s = [];\n        return (\n          n.forEach(function (o) {\n            s.push(r(o));\n          }),\n          i.decompress(s.join(\"\"))\n        );\n      },\n      compressToEncodedURIComponent: function (o) {\n        return null == o\n          ? \"\"\n          : i._compress(o, 6, function (o) {\n              return e.charAt(o);\n            });\n      },\n      decompressFromEncodedURIComponent: function (r) {\n        return null == r\n          ? \"\"\n          : \"\" == r\n          ? null\n          : ((r = r.replace(/ /g, \"+\")),\n            i._decompress(r.length, 32, function (n) {\n              return o(e, r.charAt(n));\n            }));\n      },\n      compress: function (o) {\n        return i._compress(o, 16, function (o) {\n          return r(o);\n        });\n      },\n      _compress: function (o, r, n) {\n        if (null == o) return \"\";\n        var e,\n          t,\n          i,\n          s = {},\n          p = {},\n          u = \"\",\n          c = \"\",\n          a = \"\",\n          l = 2,\n          f = 3,\n          h = 2,\n          d = [],\n          m = 0,\n          v = 0;\n        for (i = 0; i < o.length; i += 1)\n          if (\n            ((u = o.charAt(i)),\n            Object.prototype.hasOwnProperty.call(s, u) || ((s[u] = f++), (p[u] = !0)),\n            (c = a + u),\n            Object.prototype.hasOwnProperty.call(s, c))\n          )\n            a = c;\n          else {\n            if (Object.prototype.hasOwnProperty.call(p, a)) {\n              if (a.charCodeAt(0) < 256) {\n                for (e = 0; h > e; e++)\n                  (m <<= 1), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++;\n                for (t = a.charCodeAt(0), e = 0; 8 > e; e++)\n                  (m = (m << 1) | (1 & t)),\n                    v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                    (t >>= 1);\n              } else {\n                for (t = 1, e = 0; h > e; e++)\n                  (m = (m << 1) | t), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t = 0);\n                for (t = a.charCodeAt(0), e = 0; 16 > e; e++)\n                  (m = (m << 1) | (1 & t)),\n                    v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                    (t >>= 1);\n              }\n              l--, 0 == l && ((l = Math.pow(2, h)), h++), delete p[a];\n            } else\n              for (t = s[a], e = 0; h > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            l--, 0 == l && ((l = Math.pow(2, h)), h++), (s[c] = f++), (a = String(u));\n          }\n        if (\"\" !== a) {\n          if (Object.prototype.hasOwnProperty.call(p, a)) {\n            if (a.charCodeAt(0) < 256) {\n              for (e = 0; h > e; e++)\n                (m <<= 1), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++;\n              for (t = a.charCodeAt(0), e = 0; 8 > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            } else {\n              for (t = 1, e = 0; h > e; e++)\n                (m = (m << 1) | t), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t = 0);\n              for (t = a.charCodeAt(0), e = 0; 16 > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            }\n            l--, 0 == l && ((l = Math.pow(2, h)), h++), delete p[a];\n          } else\n            for (t = s[a], e = 0; h > e; e++)\n              (m = (m << 1) | (1 & t)),\n                v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                (t >>= 1);\n          l--, 0 == l && ((l = Math.pow(2, h)), h++);\n        }\n        for (t = 2, e = 0; h > e; e++)\n          (m = (m << 1) | (1 & t)), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t >>= 1);\n        for (;;) {\n          if (((m <<= 1), v == r - 1)) {\n            d.push(n(m));\n            break;\n          }\n          v++;\n        }\n        return d.join(\"\");\n      },\n      decompress: function (o) {\n        return null == o\n          ? \"\"\n          : \"\" == o\n          ? null\n          : i._decompress(o.length, 32768, function (r) {\n              return o.charCodeAt(r);\n            });\n      },\n      _decompress: function (o, n, e) {\n        var t,\n          i,\n          s,\n          p,\n          u,\n          c,\n          a,\n          l,\n          f = [],\n          h = 4,\n          d = 4,\n          m = 3,\n          v = \"\",\n          w = [],\n          A = { val: e(0), position: n, index: 1 };\n        for (i = 0; 3 > i; i += 1) f[i] = i;\n        for (p = 0, c = Math.pow(2, 2), a = 1; a != c; )\n          (u = A.val & A.position),\n            (A.position >>= 1),\n            0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n            (p |= (u > 0 ? 1 : 0) * a),\n            (a <<= 1);\n        switch ((t = p)) {\n          case 0:\n            for (p = 0, c = Math.pow(2, 8), a = 1; a != c; )\n              (u = A.val & A.position),\n                (A.position >>= 1),\n                0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                (p |= (u > 0 ? 1 : 0) * a),\n                (a <<= 1);\n            l = r(p);\n            break;\n          case 1:\n            for (p = 0, c = Math.pow(2, 16), a = 1; a != c; )\n              (u = A.val & A.position),\n                (A.position >>= 1),\n                0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                (p |= (u > 0 ? 1 : 0) * a),\n                (a <<= 1);\n            l = r(p);\n            break;\n          case 2:\n            return \"\";\n        }\n        for (f[3] = l, s = l, w.push(l); ; ) {\n          if (A.index > o) return \"\";\n          for (p = 0, c = Math.pow(2, m), a = 1; a != c; )\n            (u = A.val & A.position),\n              (A.position >>= 1),\n              0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n              (p |= (u > 0 ? 1 : 0) * a),\n              (a <<= 1);\n          switch ((l = p)) {\n            case 0:\n              for (p = 0, c = Math.pow(2, 8), a = 1; a != c; )\n                (u = A.val & A.position),\n                  (A.position >>= 1),\n                  0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                  (p |= (u > 0 ? 1 : 0) * a),\n                  (a <<= 1);\n              (f[d++] = r(p)), (l = d - 1), h--;\n              break;\n            case 1:\n              for (p = 0, c = Math.pow(2, 16), a = 1; a != c; )\n                (u = A.val & A.position),\n                  (A.position >>= 1),\n                  0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                  (p |= (u > 0 ? 1 : 0) * a),\n                  (a <<= 1);\n              (f[d++] = r(p)), (l = d - 1), h--;\n              break;\n            case 2:\n              return w.join(\"\");\n          }\n          if ((0 == h && ((h = Math.pow(2, m)), m++), f[l])) v = f[l];\n          else {\n            if (l !== d) return null;\n            v = s + s.charAt(0);\n          }\n          w.push(v),\n            (f[d++] = s + v.charAt(0)),\n            h--,\n            (s = v),\n            0 == h && ((h = Math.pow(2, m)), m++);\n        }\n      },\n    };\n  return i;\n})();\n\"function\" == typeof define && define.amd\n  ? define(function () {\n      return LZString;\n    })\n  : \"undefined\" != typeof module && null != module && (module.exports = LZString);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(607);\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"sourceRoot":""}